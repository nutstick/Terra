{"version":3,"file":"terra.es5.js","sources":["../src/Core/MapSettings.ts","../src/Math/Cartesian.ts","../src/Math/Ellipsoid.ts","../src/Utility/SphericalMercator.ts","../src/Utility/MapUtility.ts","../src/Object/RenderingObject.ts","../src/Object/Mission.ts","../src/Object/Pin.ts","../src/Object/Polygon.ts","../src/Object/Polyline.ts","../src/Object/Skybox.ts","../src/Object/Vehicle.ts","../src/Renderer/Camera.ts","../src/Renderer/OrbitConstraint.ts","../src/Renderer/OrbitControls.ts","../src/Utility/GeometricHelper.ts","../src/Core/Pool.ts","../src/Core/TileReplacementQueue.ts","../src/Core/QuadTree.ts","../src/Core/Map3D.ts","../src/Core/TilingScheme.ts","../src/DataSource/DataSource.ts","../src/DataSource/DataSourceLayer.ts","../src/DataSource/ImageDataLayer.ts","../src/DataSource/Provider.ts","../src/DataSource/ImageryProvider.ts","../src/Math/AABB.ts","../src/SceneMode/SceneMode.ts","../src/SceneMode/Tile.ts","../src/SceneMode/Tile2D.ts","../src/SceneMode/Scene2D.ts","../src/DataSource/TestDataLayer.ts","../src/DataSource/TestProvider.ts","../src/SceneMode/TestTile.ts","../src/SceneMode/TestScene.ts","../src/DataSource/BingMapImageryProvider.ts","../src/SceneMode/BingMapScene.ts","../src/DataSource/EPSG4326MapImageDataLayer.ts","../src/DataSource/EPSG4326MapImageryProvider.ts","../src/Utility/TypeConversion.ts","../src/DataSource/STKTerrainDataLayer.ts","../src/DataSource/STKTerrainProvider.ts","../src/SceneMode/STKTerrainTile.ts","../src/SceneMode/STKTerrainScene.ts"],"sourcesContent":["export const MapSettings = {\r\n    basePlaneDimension: 20037508.342789244 * 2, // Math.pow(2, 16),\r\n    cameraDistance: 1200000, // * Math.pow(2, 16),\r\n    maxCameraDistance: 1200000 * 100,\r\n    debug: true,\r\n    optimize: true,\r\n};\r\n","import * as THREE from 'three';\r\n\r\nexport interface CartesianOptions {\r\n    x?: number;\r\n    y?: number;\r\n    z?: number;\r\n    height?: number;\r\n}\r\n\r\nconst matrix = new THREE.Matrix4();\r\nexport class Cartesian {\r\n    private _x: number = 0;\r\n    private _y: number = 0;\r\n    private _z: number = 0;\r\n\r\n    constructor(options?: CartesianOptions) {\r\n        options = options || {};\r\n        this._x = options.x || 0;\r\n        this._y = options.y || 0;\r\n        this._z = options.height || options.z || 0;\r\n    }\r\n\r\n    set(x, y, z) {\r\n        this._x = x;\r\n        this._y = y;\r\n        this._z = z;\r\n\r\n        return this;\r\n    }\r\n\r\n    dot(...args): number {\r\n        return THREE.Vector3.prototype.dot.call(this, ...args);\r\n    }\r\n\r\n    add(o) {\r\n        this._x += o.x;\r\n        this._y += o.y;\r\n        this._z += o.z;\r\n        return this;\r\n    }\r\n    sub(o) {\r\n        this._x -= o.x;\r\n        this._y -= o.y;\r\n        this._z -= o.z;\r\n        return this;\r\n    }\r\n    crossVectors(...args): Cartesian {\r\n        return THREE.Vector3.prototype.crossVectors.call(this, ...args);\r\n    }\r\n    addVectors = THREE.Vector3.prototype.addVectors;\r\n    subVectors(a, b) {\r\n        this._x = a.x - b.x;\r\n        this._y = a.y - b.y;\r\n        this._z = a.z - b.z;\r\n        return this;\r\n    }\r\n    normalize = THREE.Vector3.prototype.normalize;\r\n    length = THREE.Vector3.prototype.length;\r\n    multiplyScalar = THREE.Vector3.prototype.multiplyScalar;\r\n    divideScalar = THREE.Vector3.prototype.divideScalar;\r\n\r\n    clone() {\r\n        return new Cartesian({\r\n            x: this._x,\r\n            y: this._y,\r\n            z: this._z,\r\n        });\r\n    }\r\n\r\n    copy(other) {\r\n        this._x = other.x;\r\n        this._y = other.y;\r\n        this._z = other.z;\r\n    }\r\n\r\n    unproject(camera) {\r\n        const print = (m) => {\r\n            return `${m[0]} ${m[1]} ${m[2]} ${m[3]}\r\n                ${m[4]} ${m[5]} ${m[6]} ${m[7]}\r\n                ${m[8]} ${m[9]} ${m[10]} ${m[11]}\r\n                ${m[12]} ${m[13]} ${m[14]} ${m[15]}`;\r\n        };\r\n        // console.log(print(camera.matrixWorld.elements));\r\n        // console.log(print(matrix.getInverse(camera.projectionMatrix).elements));\r\n        matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\r\n        return this.applyMatrix4(matrix);\r\n    }\r\n\r\n    applyMatrix4(m) {\r\n        const x = this.x;\r\n        const y = this.y;\r\n        const z = this.z;\r\n        const e = m.elements;\r\n\r\n        const w = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] );\r\n\r\n        this.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] ) * w;\r\n        this.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] ) * w;\r\n        this.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * w;\r\n\r\n        return this;\r\n    }\r\n\r\n    get x() { return this._x; }\r\n    set x(x) { this._x = x; }\r\n    get y() { return this._y; }\r\n    set y(y) { this._y = y; }\r\n    get z() { return this._z; }\r\n    set z(z) { this._z = z; }\r\n    get height() { return this._y; }\r\n    set height(height) { this._y = height; }\r\n}\r\n","import { Cartesian } from './Cartesian';\r\n\r\nfunction initialize(ellipsoid, x, y, z) {\r\n    x = x || 0.0;\r\n    y = y || 0.0;\r\n    z = z || 0.0;\r\n\r\n    ellipsoid._radii = new Cartesian({ x, y, z });\r\n\r\n    ellipsoid._radiiSquared = new Cartesian({ x: x * x, y: y * y, z: z * z });\r\n\r\n    ellipsoid._radiiToTheFourth = new Cartesian({ x: x * x * x * x, y: y * y * y * y, z: z * z * z * z });\r\n\r\n    ellipsoid._oneOverRadii = new Cartesian({ x: x === 0.0 ? 0.0 : 1.0 / x,\r\n        y: y === 0.0 ? 0.0 : 1.0 / y,\r\n        z: z === 0.0 ? 0.0 : 1.0 / z });\r\n\r\n    ellipsoid._oneOverRadiiSquared = new Cartesian({ x: x === 0.0 ? 0.0 : 1.0 / (x * x),\r\n        y: y === 0.0 ? 0.0 : 1.0 / (y * y),\r\n        z: z === 0.0 ? 0.0 : 1.0 / (z * z) });\r\n\r\n    ellipsoid._minimumRadius = Math.min(x, y, z);\r\n\r\n    ellipsoid._maximumRadius = Math.max(x, y, z);\r\n\r\n    // ellipsoid._centerToleranceSquared = CesiumMath.EPSILON1;\r\n\r\n    if (ellipsoid._radiiSquared.z !== 0) {\r\n        ellipsoid._squaredXOverSquaredZ = ellipsoid._radiiSquared.x / ellipsoid._radiiSquared.z;\r\n    }\r\n}\r\n\r\n/**\r\n * A quadratic surface defined in Cartesian coordinates by the equation\r\n * <code>(x / a)^2 + (y / b)^2 + (z / c)^2 = 1</code>.  Primarily used\r\n * by Cesium to represent the shape of planetary bodies.\r\n *\r\n * Rather than constructing this object directly, one of the provided\r\n * constants is normally used.\r\n * @alias Ellipsoid\r\n * @constructor\r\n *\r\n * @param {Number} [x=0] The radius in the x direction.\r\n * @param {Number} [y=0] The radius in the y direction.\r\n * @param {Number} [z=0] The radius in the z direction.\r\n *\r\n * @exception {DeveloperError} All radii components must be greater than or equal to zero.\r\n *\r\n * @see Ellipsoid.fromCartesian3\r\n * @see Ellipsoid.WGS84\r\n * @see Ellipsoid.UNIT_SPHERE\r\n */\r\nexport class Ellipsoid {\r\n    _radii: Cartesian;\r\n    _radiiSquared: Cartesian;\r\n    _radiiToTheFourth: Cartesian;\r\n    _oneOverRadii: Cartesian;\r\n    _oneOverRadiiSquared: Cartesian;\r\n    _minimumRadius: number;\r\n    _maximumRadius: number;\r\n    _centerToleranceSquared: Cartesian;\r\n    _squaredXOverSquaredZ: number;\r\n\r\n    constructor(x, y, z) {\r\n        initialize(this, x, y, z);\r\n    }\r\n\r\n    get radii() {\r\n        return this._radii;\r\n    }\r\n\r\n    get radiiSquared() {\r\n        return this._radiiSquared;\r\n    }\r\n    get radiiToTheFourth() {\r\n        return this._radiiToTheFourth;\r\n    }\r\n    get oneOverRadii() {\r\n        return this._oneOverRadii;\r\n    }\r\n    get oneOverRadiiSquared() {\r\n        return this._oneOverRadiiSquared;\r\n    }\r\n    get minimumRadius() {\r\n        return this._minimumRadius;\r\n    }\r\n    get maximumRadius() {\r\n        return this._maximumRadius;\r\n    }\r\n    get a() {\r\n        return Math.PI * this._maximumRadius;\r\n    }\r\n\r\n    static WGS84 = new Ellipsoid(6378137.0, 6378137.0, 6356752.3142451793);\r\n\r\n    static UNIT_SPHERE  = new Ellipsoid(1.0, 1.0, 1.0);\r\n}\r\n","import * as THREE from 'three';\r\nimport { MapSettings } from '../Core/MapSettings';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Ellipsoid } from '../Math/Ellipsoid';\r\n\r\nexport interface SphericalMercatorOptions {\r\n    size?: number;\r\n}\r\n\r\ninterface CacheSize {\r\n    Bc?: number[];\r\n    Cc?: number[];\r\n    zc?: number[];\r\n    Ac?: number[];\r\n}\r\n\r\nconst EPSLN = 1.0e-10;\r\nconst D2R = Math.PI / 180;\r\nconst R2D = 180 / Math.PI;\r\nconst cache: { [key: number]: CacheSize } = {};\r\n\r\nexport enum System {\r\n    WGS84 = 0,\r\n    EPSG4326 = 1,\r\n    EPSG3857 = 2,\r\n}\r\n\r\nexport class SphericalMercator {\r\n    size: number;\r\n\r\n    Ac: number[];\r\n    zc: number[];\r\n    Cc: number[];\r\n    Bc: number[];\r\n\r\n    meterPerPixel: number;\r\n\r\n    constructor(options: SphericalMercatorOptions)  {\r\n        this.size = options.size || 256;\r\n        if (!cache[this.size]) {\r\n            let size = this.size;\r\n            const c: CacheSize = cache[this.size] = {};\r\n            c.Bc = [];\r\n            c.Cc = [];\r\n            c.zc = [];\r\n            c.Ac = [];\r\n            for (let d = 0; d < 30; ++d) {\r\n                c.Bc.push(size / 360);\r\n                c.Cc.push(size / (2 * Math.PI));\r\n                c.zc.push(size / 2);\r\n                c.Ac.push(size);\r\n                size *= 2;\r\n            }\r\n        }\r\n        this.Bc = cache[this.size].Bc;\r\n        this.Cc = cache[this.size].Cc;\r\n        this.zc = cache[this.size].zc;\r\n        this.Ac = cache[this.size].Ac;\r\n\r\n        this.meterPerPixel = this.mPerPixel(0);\r\n    }\r\n\r\n    mPerPixel(latitude?: number) {\r\n        latitude = latitude || 0;\r\n        return Math.abs(Ellipsoid.WGS84.maximumRadius * 2 * Math.PI * Math.cos(latitude * Math.PI / 180) / this.size);\r\n    }\r\n    PixelToCartographic(px: THREE.Vector3, cartographic: Cartographic) {\r\n        const g = (px.z + MapSettings.basePlaneDimension / 2 - this.zc[0]) / (-this.Cc[0]);\r\n        cartographic.longitude = Math.min((px.x + MapSettings.basePlaneDimension / 2 - this.zc[0]) / this.Bc[0],\r\n            180 - EPSLN);\r\n        cartographic.latitude = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\r\n        const meterPerPixel = this.mPerPixel(cartographic.latitude);\r\n        cartographic.altitude = px.y * meterPerPixel;\r\n    }\r\n    CartographicToPixel(coordinate: Cartographic, px: THREE.Vector3) {\r\n        const d = this.zc[0];\r\n        const f = Math.min(Math.max(Math.sin(D2R * coordinate.latitude), -0.9999), 0.9999);\r\n        let x = (d + coordinate.longitude * this.Bc[0]);\r\n        let y = (d + 0.5 * Math.log((1 + f) / (1 - f)) * (-this.Cc[0]));\r\n        if (x > this.Ac[0]) {\r\n            x = this.Ac[0];\r\n        }\r\n        if (y > this.Ac[0]) {\r\n            y = this.Ac[0];\r\n        }\r\n\r\n        // if (x < 0) x = 0;\r\n        // if (y < 0) y = 0;\r\n        px.x = x - MapSettings.basePlaneDimension / 2;\r\n        px.y = coordinate.altitude / this.mPerPixel(0);\r\n        px.z = y - MapSettings.basePlaneDimension / 2;\r\n        return px;\r\n    }\r\n    /**\r\n     * Convert given lat/lon in WGS84 Datum to XY in Spherical Mercator EPSG:900913\r\n     * @param {QtPositioning.coordinate} coordinate\r\n     * @param {Cartesian} cartesian\r\n     *\r\n     * @return {Cartesian}\r\n     */\r\n    CartographicToCartesian(cartographic: Cartographic, cartesian: Cartesian) {\r\n        const d = this.zc[0];\r\n        const f = Math.min(Math.max(Math.sin(D2R * cartographic.latitude), -0.9999), 0.9999);\r\n        let x = (d + cartographic.longitude * this.Bc[0]);\r\n        let y = (d + 0.5 * Math.log((1 + f) / (1 - f)) * (-this.Cc[0]));\r\n        if (x > this.Ac[0]) {\r\n            x = this.Ac[0];\r\n        }\r\n        if (y > this.Ac[0]) {\r\n            y = this.Ac[0];\r\n        }\r\n\r\n        // if (x < 0) x = 0;\r\n        // if (y < 0) y = 0;\r\n        cartesian.x = x - MapSettings.basePlaneDimension / 2;\r\n        cartesian.y = cartographic.altitude / this.mPerPixel(0);\r\n        cartesian.z = y - MapSettings.basePlaneDimension / 2;\r\n        return cartesian;\r\n\r\n        // TODO:\r\n        // const longitude = cartographic.longitude;\r\n        // const latitude = cartographic.latitude;\r\n        // const mX = longitude * Ellipsoid.WGS84.a;\r\n        // let mY = Math.log(Math.tan((90 + latitude) * D2R / 2)) * R2D;\r\n        // mY = mY * Ellipsoid.WGS84.a / 180.0;\r\n        // cartesian.x = mX;\r\n        // cartesian.y = mY;\r\n        // cartesian.height = cartographic.altitude;\r\n        // return cartesian;\r\n    }\r\n    FCartographicToCartesian(cartographic: Cartographic, cartesian: Cartesian) {\r\n        const d = this.zc[0];\r\n        // const f = Math.min(Math.max(Math.sin(D2R * cartographic.latitude), -1), 1);\r\n        const x = (d + cartographic.longitude * this.Bc[0]);\r\n        const y = (d + 2 * cartographic.latitude * (-this.Bc[0]));\r\n        // let y = (d + 0.5 * Math.log((1 + f) / (1 - f)) * (-this.Cc[0]));\r\n        cartesian.x = x - MapSettings.basePlaneDimension / 2;\r\n        cartesian.y = cartographic.altitude / this.mPerPixel(0);\r\n        cartesian.z = y - MapSettings.basePlaneDimension / 2;\r\n        return cartesian;\r\n    }\r\n    CartesianToCartographic(cartesian: Cartesian, cartographic: Cartographic) {\r\n        const g = (cartesian.z + MapSettings.basePlaneDimension / 2 - this.zc[0]) / (-this.Cc[0]);\r\n        cartographic.longitude = Math.min((cartesian.x + MapSettings.basePlaneDimension / 2 - this.zc[0]) / this.Bc[0],\r\n            180 - EPSLN);\r\n        cartographic.latitude = R2D * (2 * Math.atan(Math.exp(g)) - 0.5 * Math.PI);\r\n        const meterPerPixel = this.mPerPixel(cartographic.latitude);\r\n        cartographic.altitude = cartesian.y * meterPerPixel;\r\n    }\r\n\r\n    CartographicToEPSG4326(cartographic: Cartographic, cartesian: Cartesian) {\r\n        cartesian.x = cartographic.longitude / 90 * Ellipsoid.WGS84.maximumRadius;\r\n        cartesian.y = cartographic.altitude;\r\n        cartesian.z = cartographic.latitude / 90 * Ellipsoid.WGS84.maximumRadius;\r\n    }\r\n}\r\n\r\nexport const sphericalMercator = new SphericalMercator({ size: MapSettings.basePlaneDimension });\r\n","import * as THREE from 'three';\r\nimport { sphericalMercator } from './SphericalMercator';\r\n\r\nconst screenPosition = new THREE.Vector2();\r\n\r\nexport class MapUtility {\r\n    static ground(position) {\r\n        const _ = position.clone();\r\n        // FIXME: ground = 0 by now\r\n        _.y = 0;\r\n        return _;\r\n    }\r\n\r\n    static tenMeters(latitude?: number) {\r\n        return 10 / (latitude ? sphericalMercator.mPerPixel(latitude) : sphericalMercator.meterPerPixel);\r\n    }\r\n\r\n    static rayCasterFromScreen(primitive, x, y, picker) {\r\n        screenPosition.set((x / primitive.canvas.width) * 2 - 1, -(y / primitive.canvas.height) * 2 + 1);\r\n        picker.setFromCamera(screenPosition, primitive.camera);\r\n\r\n        return picker;\r\n    }\r\n\r\n    static lerp(p, q, time) {\r\n        return ((1.0 - time) * p) + (time * q);\r\n    }\r\n}\r\n","import { Cartesian } from '../Math/Cartesian';\r\n\r\nexport abstract class RenderingObject {\r\n    abstract updateTarget(target: Cartesian);\r\n\r\n    abstract coordinate(): Cartographic;\r\n\r\n    abstract getScale(): number;\r\n    abstract setScale(scale: number);\r\n}\r\n","import { Map3D } from '../Core/Map3D';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { OrbitControls } from '../Renderer/OrbitControls';\r\nimport { Pin } from './Pin';\r\nimport { RenderingObject } from './RenderingObject';\r\n\r\nexport interface MissionOptions {\r\n    map: Map3D;\r\n}\r\n\r\nexport abstract class Mission extends RenderingObject {\r\n    _map: Map3D;\r\n    constructor(options: MissionOptions) {\r\n        super();\r\n        this._map = options.map;\r\n    }\r\n\r\n    // abstract addPin(position: Cartographic | Cartesian, height: number)\r\n    abstract updatePin(index: number);\r\n    // abstract clearPins();\r\n    // abstract reindex(pin: Pin, index: number);\r\n    abstract interactableObjects(): THREE.Mesh[];\r\n\r\n    abstract onMouseDown(controls: OrbitControls, x: number, y: number, button: number): boolean;\r\n    abstract onMouseMove(controls: OrbitControls, x: number, y: number): boolean;\r\n\r\n    abstract get pins(): Pin[];\r\n}\r\n","import * as THREE from 'three';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { Mission } from './Mission';\r\nimport { RenderingObject } from './RenderingObject';\r\n\r\nexport interface PinOptions {\r\n    mission: Mission;\r\n    index: number;\r\n    position: Cartographic | Cartesian;\r\n}\r\n\r\nexport interface Head extends THREE.Mesh {\r\n    pin: Pin;\r\n    geometry: THREE.Geometry;\r\n    material: THREE.Material;\r\n}\r\n\r\nexport interface Arrow extends THREE.Mesh {\r\n    pin: Pin;\r\n    geometry: THREE.Geometry;\r\n    material: THREE.Material;\r\n}\r\n\r\nexport class Pin extends RenderingObject {\r\n    _mission: Mission;\r\n    _index: number;\r\n\r\n    head: Head;\r\n    arrow: Arrow;\r\n    line: THREE.LineSegments;\r\n\r\n    group: THREE.Group;\r\n\r\n    _rGPosition: THREE.Vector3;\r\n    _rPosition: THREE.Vector3;\r\n    _position: Cartesian;\r\n    _coordinate: Cartographic;\r\n\r\n    lastScale: number;\r\n\r\n    constructor(options: PinOptions) {\r\n        super();\r\n        this._mission = options.mission;\r\n        this._index = options.index;\r\n\r\n        const headGeometry = new THREE.CylinderGeometry(3, 3, 8, 8, 1);\r\n        // Recalculate centroid of mesh offset by 8\r\n        for (let i = 0, len = headGeometry.vertices.length; i < len; i++) {\r\n            headGeometry.vertices[i].y += 8;\r\n        }\r\n\r\n        this.head = (new THREE.Mesh(\r\n            headGeometry,\r\n            new THREE.MeshBasicMaterial({ color: 0x3366ff, opacity: 0.8, transparent: true }),\r\n        ) as Head);\r\n        this.head.name = 'Head';\r\n        this.head.pin = this;\r\n\r\n        const arrowGeometry = new THREE.CylinderGeometry(4, 0, 6, 6, 1);\r\n        // Recalculate centroid\r\n        for (let i_ = 0, len_ = arrowGeometry.vertices.length; i_ < len_; i_++) {\r\n            arrowGeometry.vertices[i_].y += 3;\r\n        }\r\n        arrowGeometry.computeBoundingSphere();\r\n\r\n        this.arrow = (new THREE.Mesh(\r\n            arrowGeometry,\r\n            new THREE.MeshBasicMaterial({ color: 0xffff00, opacity: 0.8, transparent: true }),\r\n        ) as Arrow);\r\n        this.arrow.name = 'Arrow';\r\n        this.arrow.pin = this;\r\n\r\n        const lineGeometry = new THREE.Geometry();\r\n        lineGeometry.vertices.push(this.arrow.position);\r\n        lineGeometry.vertices.push(this.head.position);\r\n\r\n        this.line = new THREE.LineSegments(\r\n            lineGeometry,\r\n            new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 3, transparent: true, opacity: 0.8 }),\r\n        );\r\n        this.line.name = 'Line';\r\n        /**\r\n         * Pack of all mesh in pin (head, line, arrow)\r\n         * @type {THREE.Group}\r\n         */\r\n        this.group = new THREE.Group();\r\n        this.group.add(this.head);\r\n        this.group.add(this.line);\r\n        this.group.add(this.arrow);\r\n        this.group.name = 'Pin';\r\n        // TODO: Map should have addRenderingObject function instead of direct access to scene\r\n        this._mission._map.scene.add(this.group);\r\n\r\n        this._rGPosition = this.arrow.position;\r\n        this._rPosition = this.head.position;\r\n\r\n        // TODO: Can it be Carsetian\r\n        this._position = new Cartesian();\r\n        this._coordinate = QtPositioning.coordinate();\r\n        // Initialize pin position\r\n        this.position = options.position;\r\n        /**\r\n         * Last move scale of pin\r\n         * @type {number}\r\n         */\r\n        // TODO: lastScale inside mission or map so that no need to calculate on all pin\r\n        this.lastScale = 1.0;\r\n        // Add Target Subscribe to this object\r\n        this._mission._map.addSubscribeObject(this);\r\n    }\r\n    /**\r\n     * Free memory and remove pin from rendering\r\n     */\r\n    dispose() {\r\n        this.group.remove(this.head);\r\n        this.group.remove(this.line);\r\n        this._mission._map.removeSubscribeObject(this);\r\n        this._mission._map.scene.remove(this.group);\r\n        this._mission = undefined;\r\n        this.group = undefined;\r\n        // Clear Meshes\r\n        this.head.geometry.dispose();\r\n        this.head.material.dispose();\r\n        this.head = undefined;\r\n        this.line.geometry.dispose();\r\n        this.line.material.dispose();\r\n        this.line = undefined;\r\n        this.arrow.geometry.dispose();\r\n        this.arrow.material.dispose();\r\n        this.arrow = undefined;\r\n        this._rGPosition = undefined;\r\n        this._rPosition = undefined;\r\n        this._position = undefined;\r\n    }\r\n    updateTarget(target) {\r\n        // Update rendering position\r\n        this._rPosition.subVectors((this._position as any), target);\r\n        // TODO: elevation projection instead of 0\r\n        this._rGPosition.set(this._rPosition.x, 0, this._rPosition.z);\r\n        (this.line.geometry as THREE.Geometry).verticesNeedUpdate = true;\r\n    }\r\n\r\n    get position() { return this._position; }\r\n    set position(p: any) {\r\n        if (!p) {\r\n            this._position.y = MapUtility.tenMeters();\r\n        } else {\r\n            // Case position is a QtPositioning.coordiante\r\n            if (p.longitude) {\r\n                sphericalMercator.CartographicToCartesian(p, this._position);\r\n            } else {\r\n                this._position.copy(p);\r\n                // Default height is 10 meters\r\n                this._position.y = this._position.y || MapUtility.tenMeters();\r\n            }\r\n        }\r\n        // Update rendering position\r\n        this.updateTarget(this._mission._map.camera.target);\r\n\r\n        this._mission.updatePin(this._index);\r\n    }\r\n\r\n    get groundPosition() { return new THREE.Vector3(this._position.x, 0, this._position.y); }\r\n    set groundPosition(p: any) {\r\n        // Case position is a QtPositioning.coordiante\r\n        if (p.longitude) {\r\n            // TODO: Ground\r\n            sphericalMercator.CartographicToCartesian(p, this._position);\r\n            this._position.y = 0;\r\n        } else {\r\n            this._position.x = p.x;\r\n            this._position.z = p.z;\r\n        }\r\n\r\n        this.updateTarget(this._mission._map.camera.target);\r\n\r\n        this._mission.updatePin(this._index);\r\n    }\r\n\r\n    coordinate() {\r\n        sphericalMercator.CartesianToCartographic(this._position, this._coordinate);\r\n        return this._coordinate;\r\n    }\r\n\r\n    get height() { return this._position.y; }\r\n    set height(h) {\r\n        this._position.y = h;\r\n\r\n        this.updateTarget(this._mission._map.camera.target);\r\n\r\n        this._mission.updatePin(this._index);\r\n    }\r\n\r\n    getScale() { return this.lastScale; }\r\n    setScale(s: number) {\r\n        if (this.lastScale === s) {\r\n            return;\r\n        }\r\n\r\n        this.head.geometry.scale(s / this.lastScale, s / this.lastScale, s / this.lastScale);\r\n        this.arrow.geometry.scale(s / this.lastScale, s / this.lastScale, s / this.lastScale);\r\n        this.lastScale = s;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Geometry, Material } from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { MapSettings } from '../Core/MapSettings';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { OrbitControls } from '../Renderer/OrbitControls';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { Mission, MissionOptions } from './Mission';\r\nimport { Pin } from './Pin';\r\n\r\nconst panStart = new THREE.Vector2();\r\nconst picker = new THREE.Raycaster();\r\n\r\nconst panEnd = new THREE.Vector2();\r\nconst panDelta = new THREE.Vector2();\r\n\r\nconst px = new THREE.Vector3();\r\n\r\nexport interface PolygonOptions extends MissionOptions {}\r\n\r\nexport class Polygon extends Mission {\r\n    static STATE = { CHANGE_PIN_HEIGHT: -2, CHANGE_PIN_POSITION: -3 };\r\n\r\n    _map: Map3D;\r\n    pins: Pin[];\r\n    grids: Cartographic[][];\r\n    angles: number[];\r\n    lines: THREE.LineSegments[];\r\n\r\n    gridMesh: THREE.Group;\r\n    gridGenerateOffset: THREE.Vector3 = new THREE.Vector3();\r\n    _closeLine: THREE.LineSegments;\r\n\r\n    debug: { updated: boolean; };\r\n\r\n    enableMoveMarker: boolean;\r\n    activePin: Pin;\r\n\r\n    constructor(options: MissionOptions) {\r\n        super(options);\r\n\r\n        this.pins = [];\r\n\r\n        this.grids = [];\r\n\r\n        this.angles = [];\r\n\r\n        this.lines = [];\r\n\r\n        this.gridMesh = undefined;\r\n        this.gridGenerateOffset = new THREE.Vector3();\r\n\r\n        this._closeLine = undefined;\r\n        this.debug = {\r\n            updated: false,\r\n        };\r\n        this._map.addSubscribeObject(this);\r\n        /**\r\n         * Controller\r\n         */\r\n\r\n        this.enableMoveMarker = true;\r\n        this.activePin = undefined;\r\n    }\r\n\r\n    updateTarget(target: Cartesian) {\r\n        this.lines.forEach((line) => {\r\n            (line.geometry as Geometry).verticesNeedUpdate = true;\r\n        });\r\n        if (this._closeLine) {\r\n            (this._closeLine.geometry as Geometry).verticesNeedUpdate = true;\r\n        }\r\n        if (this.gridMesh) {\r\n            this.gridMesh.position.set(\r\n                this.gridGenerateOffset.x - target.x,\r\n                this.gridGenerateOffset.y - target.y,\r\n                this.gridGenerateOffset.z - target.z,\r\n            );\r\n        }\r\n    }\r\n\r\n    addPin(position?: Cartographic | Cartesian, height?: number) {\r\n        const index = this.pins.length;\r\n        const pin = new Pin({\r\n            index,\r\n            mission: (this as Mission),\r\n            position,\r\n        });\r\n        this.pins.push(pin);\r\n        if (this.pins.length > 1) {\r\n            const lineGeometry = new THREE.Geometry();\r\n            lineGeometry.vertices.push(this.pins[index - 1].head.position);\r\n            lineGeometry.vertices.push(this.pins[index].head.position);\r\n            const line = new THREE.LineSegments(\r\n                lineGeometry,\r\n                new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 3, transparent: true, opacity: 0.6 }),\r\n            );\r\n            this.lines.push(line);\r\n            this._map.scene.add(line);\r\n            if (!this._closeLine) {\r\n                const lineGeometry_ = new THREE.Geometry();\r\n                lineGeometry_.vertices.push(this.pins[index].head.position);\r\n                lineGeometry_.vertices.push(this.pins[0].head.position);\r\n                this._closeLine = new THREE.LineSegments(\r\n                    lineGeometry_,\r\n                    new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 3, transparent: true, opacity: 0.6 }),\r\n                );\r\n                this._map.scene.add(this._closeLine);\r\n            } else {\r\n                (this._closeLine.geometry as Geometry).vertices[0] = this.pins[index].head.position;\r\n                (this._closeLine.geometry as Geometry).verticesNeedUpdate = true;\r\n            }\r\n        }\r\n        if (MapSettings.debug) {\r\n            this.debug = { updated: true };\r\n        }\r\n        return pin;\r\n    }\r\n\r\n    updatePin(index: number) {\r\n        if (index > 0 && index - 1 < this.lines.length) {\r\n            (this.lines[index - 1].geometry as Geometry).verticesNeedUpdate = true;\r\n        }\r\n        if (index + 1 < this.pins.length) {\r\n            (this.lines[index].geometry as Geometry).verticesNeedUpdate = true;\r\n        }\r\n        if (this.pins.length > 1) {\r\n            if (index === 0) {\r\n                (this._closeLine.geometry as Geometry).verticesNeedUpdate = true;\r\n            } else if (index + 1 === this.pins.length) {\r\n                (this._closeLine.geometry as Geometry).verticesNeedUpdate = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    clearPins() {\r\n        // Clear all pins\r\n        this.pins.forEach((pin) => {\r\n            pin.dispose();\r\n        });\r\n        this.pins.length = 0;\r\n        for (let i_ = 0; i_ < this.lines.length; i_++) {\r\n            const line = this.lines[i_];\r\n            this._map.scene.remove(line);\r\n            line.geometry.dispose();\r\n            line.material.dispose();\r\n            this.lines[i_] = undefined;\r\n        }\r\n        this.lines.length = 0;\r\n        if (this._closeLine) {\r\n            this._map.scene.remove(this._closeLine);\r\n            this._closeLine.geometry.dispose();\r\n            this._closeLine.material.dispose();\r\n            this._closeLine = undefined;\r\n        }\r\n        this.grids = undefined;\r\n        if (this.gridMesh) {\r\n            this._map.scene.remove(this.gridMesh);\r\n            this.gridMesh = undefined;\r\n        }\r\n    }\r\n\r\n    interactableObjects() {\r\n        return this.pins.reduce((prev: THREE.Mesh[], pin) => {\r\n            prev.push(pin.head);\r\n            prev.push(pin.arrow);\r\n            return prev;\r\n        }, []);\r\n    }\r\n\r\n    onMouseDown(controls: OrbitControls, x: number, y: number, button: number) {\r\n        const now = Date.now();\r\n        let intersects;\r\n        panStart.set(x, y);\r\n        // Doubled click => Create new PIN\r\n        if (controls._lastClick && now - controls._lastClick < controls.constraint.maxClickTimeInterval &&\r\n            this.enableMoveMarker === true) {\r\n            MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n            intersects = picker.intersectObjects(this._map.quadTree.tiles.children);\r\n            if (!intersects.length) {\r\n                console.warn('Mouse down position have no intersect with any tiles.');\r\n                controls._lastClick = null;\r\n                return true;\r\n            } else if (intersects.length > 1) {\r\n                console.warn('Mouse down on more than one tile.');\r\n            }\r\n            const position = intersects[0].point.add(controls.camera.target);\r\n            this.activePin = this.addPin(position);\r\n            controls._state = Polygon.STATE.CHANGE_PIN_HEIGHT;\r\n            controls._lastClick = null;\r\n            return true;\r\n        }\r\n        MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n        intersects = picker.intersectObjects(this.interactableObjects());\r\n        if (intersects.length > 0) {\r\n            const obj = intersects[0].object;\r\n            if (obj.name === 'Head') {\r\n                this.activePin = obj.pin;\r\n                controls._state = Polygon.STATE.CHANGE_PIN_HEIGHT;\r\n            } else if (obj.name === 'Arrow') {\r\n                this.activePin = obj.pin;\r\n                controls._state = Polygon.STATE.CHANGE_PIN_POSITION;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    onMouseMove(controls, x, y) {\r\n        if (controls._state === Polygon.STATE.CHANGE_PIN_HEIGHT) {\r\n            if (!this.enableMoveMarker) {\r\n                return false;\r\n            }\r\n            panEnd.set(x, y);\r\n            panDelta.subVectors(panEnd, panStart);\r\n            this.activePin.height += -panDelta.y * controls.camera.position.y / controls.canvas.height;\r\n            panStart.copy(panEnd);\r\n            return true;\r\n        } else if (controls._state === Polygon.STATE.CHANGE_PIN_POSITION) {\r\n            if (!this.enableMoveMarker) {\r\n                return false;\r\n            }\r\n            MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n            // TODO: Deprecated base plane\r\n            const markerPosition = picker.intersectObjects(this._map.quadTree.tiles.children)[0].point;\r\n            this.activePin.groundPosition = markerPosition.add(controls.camera.target);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    generateGrid(type: string, gridSpace?: number, angle?: number, speed?: number, minute?: number) {\r\n        const target = this._map.camera.target;\r\n        this.gridGenerateOffset.set(target.x, target.y, target.z);\r\n        // Call C++ function to genreate flight grid\r\n        if (type === 'opt') {\r\n            if (speed) {\r\n                optimizeGridCalculation.speed = speed;\r\n            }\r\n            if (minute) {\r\n                optimizeGridCalculation.minute = minute;\r\n            }\r\n            const res = optimizeGridCalculation.genGridInsideBound(this.pinsCoordinate,\r\n                this._map.vehicle.coordinate(), gridSpace);\r\n\r\n            this.grids = res.map((x) => {\r\n                return x.grid;\r\n            });\r\n            this.angles = res.map((x) => {\r\n                return x.angle;\r\n            });\r\n        } else {\r\n            if (speed) {\r\n                gridcalculation.speed = speed;\r\n            }\r\n            if (minute) {\r\n                gridcalculation.minute = minute;\r\n            }\r\n            this.grids = gridcalculation.genGridInsideBound(this.pinsCoordinate,\r\n                this._map.vehicle.coordinate(), gridSpace, angle || 0);\r\n        }\r\n        // Redraw grid mesh\r\n        // Remove exist mesh first\r\n        if (this.gridMesh) {\r\n            this.gridMesh.children.map((mesh) => {\r\n                (mesh as THREE.Mesh).geometry.dispose();\r\n                ((mesh as THREE.Mesh).material as Material).dispose();\r\n            });\r\n            this.gridMesh.children.length = 0;\r\n            this._map.scene.remove(this.gridMesh);\r\n        }\r\n        // Define grid mesh as an array of consecutive line\r\n        this.gridMesh = new THREE.Group();\r\n        this._map.scene.add(this.gridMesh);\r\n        // Create each grid from geneated data\r\n        this.grids.forEach((grid) => {\r\n            const lineGeometry = new THREE.Geometry();\r\n            for (let i = 0; i < grid.length; i++) {\r\n                // Passing Geocoordinate to 3D Point\r\n                sphericalMercator.CartographicToPixel(grid[i], px);\r\n                // Doubling point, so it's will render consecutive line\r\n                const v = px.clone().sub(this.gridGenerateOffset);\r\n                if (i !== 0) {\r\n                    lineGeometry.vertices.push(v);\r\n                }\r\n                lineGeometry.vertices.push(v);\r\n            }\r\n            this.gridMesh.add(new THREE.LineSegments(\r\n                lineGeometry,\r\n                new THREE.LineBasicMaterial({\r\n                    color: Math.random() * 0xffffff,\r\n                    linewidth: 3,\r\n                    transparent: true,\r\n                    opacity: 0.8,\r\n                }),\r\n                // new THREE.LineBasicMaterial({ color: 0x00e500, linewidth: 3, transparent: true, opacity: 0.8 })\r\n            ));\r\n        });\r\n        return this.grids;\r\n    }\r\n\r\n    get pinsCoordinate() {\r\n        return this.pins.map((pin) => {\r\n            return pin.coordinate();\r\n        });\r\n    }\r\n\r\n    coordinate() {\r\n        return QtPositioning.coordinate();\r\n    }\r\n    getScale() { return 1; }\r\n    setScale(scale) { return; }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Geometry, Material } from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { MapSettings } from '../Core/MapSettings';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { OrbitControls } from '../Renderer/OrbitControls';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { Mission, MissionOptions } from './Mission';\r\nimport { Pin } from './Pin';\r\n\r\nconst panStart = new THREE.Vector2();\r\nconst picker = new THREE.Raycaster();\r\n\r\nconst panEnd = new THREE.Vector2();\r\nconst panDelta = new THREE.Vector2();\r\n\r\nconst px = new THREE.Vector3();\r\n\r\nexport interface PolygonOptions extends MissionOptions {}\r\n\r\nexport class Polyline extends Mission {\r\n    static STATE = { CHANGE_PIN_HEIGHT: -2, CHANGE_PIN_POSITION: -3 };\r\n\r\n    _map: Map3D;\r\n    pins: Pin[];\r\n    angles: number[];\r\n    lines: THREE.LineSegments[];\r\n\r\n    debug: { updated: boolean; };\r\n\r\n    enableMoveMarker: boolean;\r\n    activePin: Pin;\r\n\r\n    constructor(options: MissionOptions) {\r\n        super(options);\r\n        /**\r\n         * Pin point that define polyline direction\r\n         * @type {Pin[]}\r\n         */\r\n        this.pins = [];\r\n        /**\r\n         * Three.Line\r\n         * @type {THREE.LineSegments}\r\n         */\r\n        this.lines = [];\r\n        this.debug = {\r\n            updated: false,\r\n        };\r\n        this._map.addSubscribeObject(this);\r\n        /**\r\n         * Controller\r\n         */\r\n        /**\r\n         * Set to false to disable marker modifiered\r\n         * @type {bool}\r\n         */\r\n        this.enableMoveMarker = true;\r\n        this.activePin = undefined;\r\n    }\r\n\r\n    updateTarget(target: Cartesian) {\r\n        this.lines.forEach((line) => {\r\n            (line.geometry as Geometry).verticesNeedUpdate = true;\r\n        });\r\n    }\r\n\r\n    addPin(position?: Cartographic | Cartesian, height?: number) {\r\n        const index = this.pins.length;\r\n        const pin = new Pin({\r\n            index,\r\n            mission: (this as Mission),\r\n            position,\r\n        });\r\n        this.pins.push(pin);\r\n        if (this.pins.length > 1) {\r\n            const lineGeometry = new THREE.Geometry();\r\n            lineGeometry.vertices.push(this.pins[index - 1].head.position);\r\n            lineGeometry.vertices.push(this.pins[index].head.position);\r\n            const line = new THREE.LineSegments(\r\n                lineGeometry,\r\n                new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 3, transparent: true, opacity: 0.6 }),\r\n            );\r\n            this.lines.push(line);\r\n            this._map.scene.add(line);\r\n        }\r\n        if (MapSettings.debug) {\r\n            this.debug = { updated: true };\r\n        }\r\n        return pin;\r\n    }\r\n\r\n    updatePin(index: number) {\r\n        if (index > 0 && index - 1 < this.lines.length) {\r\n            (this.lines[index - 1].geometry as Geometry).verticesNeedUpdate = true;\r\n        }\r\n        if (index + 1 < this.pins.length) {\r\n            (this.lines[index].geometry as Geometry).verticesNeedUpdate = true;\r\n        }\r\n    }\r\n\r\n    clearPins() {\r\n        // Clear all pins\r\n        this.pins.forEach((pin) => pin.dispose());\r\n        this.pins.length = 0;\r\n        for (let i_ = 0; i_ < this.lines.length; i_++) {\r\n            const line = this.lines[i_];\r\n            this._map.scene.remove(line);\r\n            line.geometry.dispose();\r\n            line.material.dispose();\r\n            this.lines[i_] = undefined;\r\n        }\r\n        this.lines.length = 0;\r\n    }\r\n\r\n    interactableObjects() {\r\n        return this.pins.reduce((prev: THREE.Mesh[], pin) => {\r\n            prev.push(pin.head);\r\n            prev.push(pin.arrow);\r\n            return prev;\r\n        }, []);\r\n    }\r\n\r\n    onMouseDown(controls: OrbitControls, x: number, y: number, button: number) {\r\n        const now = Date.now();\r\n        let intersects;\r\n        panStart.set(x, y);\r\n        // Doubled click => Create new PIN\r\n        if (controls._lastClick && now - controls._lastClick < controls.constraint.maxClickTimeInterval &&\r\n            this.enableMoveMarker === true) {\r\n            MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n            intersects = picker.intersectObjects(this._map.quadTree.tiles.children);\r\n            if (!intersects.length) {\r\n                console.warn('Mouse down position have no intersect with any tiles.');\r\n                controls._lastClick = null;\r\n                return true;\r\n            } else if (intersects.length > 1) {\r\n                console.warn('Mouse down on more than one tile.');\r\n            }\r\n            const position = intersects[0].point.add(controls.camera.target);\r\n            this.activePin = this.addPin(position);\r\n            controls._state = Polyline.STATE.CHANGE_PIN_HEIGHT;\r\n            controls._lastClick = null;\r\n            return true;\r\n        }\r\n        MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n        intersects = picker.intersectObjects(this.interactableObjects());\r\n        if (intersects.length > 0) {\r\n            const obj = intersects[0].object;\r\n            if (obj.name === 'Head') {\r\n                this.activePin = obj.pin;\r\n                controls._state = Polyline.STATE.CHANGE_PIN_HEIGHT;\r\n            } else if (obj.name === 'Arrow') {\r\n                this.activePin = obj.pin;\r\n                controls._state = Polyline.STATE.CHANGE_PIN_POSITION;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    onMouseMove(controls, x, y) {\r\n        if (controls._state === Polyline.STATE.CHANGE_PIN_HEIGHT) {\r\n            if (!this.enableMoveMarker) {\r\n                return false;\r\n            }\r\n            panEnd.set(x, y);\r\n            panDelta.subVectors(panEnd, panStart);\r\n            this.activePin.height += -panDelta.y * controls.camera.position.y / controls.canvas.height;\r\n            panStart.copy(panEnd);\r\n            return true;\r\n        } else if (controls._state === Polyline.STATE.CHANGE_PIN_POSITION) {\r\n            if (!this.enableMoveMarker) {\r\n                return false;\r\n            }\r\n            MapUtility.rayCasterFromScreen(controls, x, y, picker);\r\n            // TODO: Deprecated base plane\r\n            const markerPosition = picker.intersectObjects(this._map.quadTree.tiles.children)[0].point;\r\n            this.activePin.groundPosition = markerPosition.add(controls.camera.target);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get pinsCoordinate() {\r\n        return this.pins.map((pin) => pin.coordinate());\r\n    }\r\n\r\n    coordinate() {\r\n        return QtPositioning.coordinate();\r\n    }\r\n    getScale() { return 1; }\r\n    setScale(scale) { return; }\r\n}\r\n","import * as THREE from 'three';\nimport { MapSettings } from '../Core/MapSettings';\nimport { TextureLoader } from 'three';\n\nexport class Skybox extends THREE.Mesh {\n    constructor() {\n        const skyboxTexture = new THREE.CubeTexture([]);\n        skyboxTexture.format = THREE.RGBFormat;\n\n        // const loader = new THREE.ImageLoader();\n        const textures = [\n            new TextureLoader().load('../skybox/skybox_nx.jpg'),\n            new TextureLoader().load('../skybox/skybox_ny.jpg'),\n            new TextureLoader().load('../skybox/skybox_nz.jpg'),\n            new TextureLoader().load('../skybox/skybox_px.jpg'),\n            new TextureLoader().load('../skybox/skybox_py.jpg'),\n            new TextureLoader().load('../skybox/skybox_pz.jpg'),\n        ];\n        // loader.load('./2.png', (image) => {\n        //     const getSide = (x, y) => {\n        //         const size = 1024;\n\n        //         const canvas = document.createElement('canvas');\n        //         canvas.width = size;\n        //         canvas.height = size;\n\n        //         const context = canvas.getContext('2d');\n        //         context.drawImage(image, - x * size, - y * size);\n\n        //         return new THREE.Texture(canvas);\n        //     };\n\n        //     skyboxTexture.images[ 0 ] = getSide( 2, 1 ); // px\n        //     skyboxTexture.images[ 1 ] = getSide( 0, 1 ); // nx\n        //     skyboxTexture.images[ 2 ] = getSide( 1, 0 ); // py\n        //     skyboxTexture.images[ 3 ] = getSide( 1, 2 ); // ny\n        //     skyboxTexture.images[ 4 ] = getSide( 1, 1 ); // pz\n        //     skyboxTexture.images[ 5 ] = getSide( 3, 1 ); // nz\n        //     skyboxTexture.needsUpdate = true;\n        // });\n        const materialArray = [];\n        for (let i = 0; i < 6; i++) {\n            materialArray.push( new THREE.MeshBasicMaterial({\n                color: 0x000000,\n                // map: textures[0],\n                // wireframe: true,\n                side: THREE.DoubleSide,\n            }));\n        }\n        const skyMaterial = new THREE.MeshFaceMaterial( materialArray );\n        // const shader = THREE.ShaderLib.cube;\n        // const uniforms = THREE.UniformsUtils.clone(shader.uniforms);\n        // uniforms.tCube.texture = skyboxTexture;   // textureCube has been init before\n        // const material_ = new THREE.ShaderMaterial({\n        //     fragmentShader: shader.fragmentShader,\n        //     vertexShader: shader.vertexShader,\n        //     uniforms,\n        // });\n\n        super(\n            new THREE.CubeGeometry(\n                MapSettings.basePlaneDimension,\n                MapSettings.basePlaneDimension,\n                MapSettings.basePlaneDimension,\n                1, 1, 1,\n            ),\n            skyMaterial,\n        );\n\n        this.position.y = MapSettings.basePlaneDimension / 2 - 100;\n    }\n}\n","import * as THREE from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { RenderingObject } from './RenderingObject';\r\n\r\nexport interface VehicleOptions {\r\n    map: Map3D;\r\n    position?: Cartographic | Cartesian;\r\n}\r\n\r\nexport interface Head extends THREE.Mesh {\r\n    geometry: THREE.Geometry;\r\n    material: THREE.Material;\r\n}\r\n\r\nexport class Vehicle extends RenderingObject {\r\n    _map: Map3D;\r\n\r\n    head: Head;\r\n    line: THREE.LineSegments;\r\n\r\n    group: THREE.Group;\r\n\r\n    _headAngle: number;\r\n    _rGPosition: THREE.Vector3;\r\n    _rPosition: THREE.Vector3;\r\n    _position: THREE.Vector3;\r\n    _coordinate: Cartographic;\r\n\r\n    lastScale: number;\r\n\r\n    constructor(options: VehicleOptions) {\r\n        super();\r\n\r\n        this._map = options.map;\r\n\r\n        const headGeometry = new THREE.Geometry();\r\n        const radius = 7.5;\r\n        const x = radius * 2.0 / 3.0;\r\n        const offset = 0; // radius / 3.0;\r\n        headGeometry.vertices = [\r\n            new THREE.Vector3(0.0, 0.0, 0.0 + offset),\r\n            new THREE.Vector3(-x * Math.sqrt(3), x, x + offset),\r\n            new THREE.Vector3(x * Math.sqrt(3), x, x + offset),\r\n            new THREE.Vector3(0.0, x * 2.0 / 3.0, 0.0 + offset),\r\n            new THREE.Vector3(0.0, 0.0, -2 * x + offset),\r\n        ];\r\n        headGeometry.faces = [\r\n            new THREE.Face3(0, 2, 3),\r\n            new THREE.Face3(0, 3, 1),\r\n            new THREE.Face3(0, 4, 2),\r\n            new THREE.Face3(0, 1, 4),\r\n            new THREE.Face3(3, 4, 1),\r\n            new THREE.Face3(3, 2, 4),\r\n        ];\r\n        headGeometry.computeFaceNormals();\r\n        headGeometry.rotateX(10 / 180 * Math.PI);\r\n        /**\r\n         * Pin's head mesh\r\n         * @type {THREE.Mesh}\r\n         */\r\n        this.head = (new THREE.Mesh(\r\n            headGeometry,\r\n            new THREE.MeshBasicMaterial({ color: 0x3366ff, opacity: 0.8, transparent: true }),\r\n        ) as Head);\r\n        this.head.name = 'Head';\r\n        /**\r\n         * Line between head and arrow geometry\r\n         * @type {THREE.Geometry}\r\n         */\r\n        const lineGeometry = new THREE.Geometry();\r\n        lineGeometry.vertices.push(new THREE.Vector3());\r\n        lineGeometry.vertices.push(this.head.position);\r\n        /**\r\n         * ine between head and arrow\r\n         * @type {THREE.LineSegments}\r\n         */\r\n        this.line = new THREE.LineSegments(\r\n            lineGeometry,\r\n            new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 3, transparent: true, opacity: 0.8 }),\r\n        );\r\n        this.line.name = 'Line';\r\n        /**\r\n         * Pack of all mesh in pin (head, line, arrow)\r\n         * @type {THREE.Group}\r\n         */\r\n        this.group = new THREE.Group();\r\n        this.group.add(this.head);\r\n        this.group.add(this.line);\r\n        this.group.name = 'Vehicle';\r\n        options.map.scene.add(this.group);\r\n        // var box = new THREE.BoxHelper(this.group, 0xffff00);\r\n        // options.map.scene.add(box);\r\n        /**\r\n         * Rendered Point at Ground\r\n         * @type {THREE.Vector3}\r\n         * @private\r\n         */\r\n        this._rGPosition = (this.line.geometry as THREE.Geometry).vertices[0];\r\n        /**\r\n         * Rendered Point\r\n         * @type {THREE.Vector3}\r\n         * @private\r\n         */\r\n        this._rPosition = this.head.position;\r\n        // TODO: Can it be Carsetian\r\n        /**\r\n         * Position\r\n         * @type {THREE.Vector3}\r\n         * @private\r\n         */\r\n        this._position = new THREE.Vector3();\r\n        this._coordinate = QtPositioning.coordinate();\r\n        /**\r\n         * Head angle from North (0, -1, 0)\r\n         * @type {number}\r\n         * @private\r\n         */\r\n        this._headAngle = 0.0;\r\n        // Initialize pin position\r\n        if (options.position) {\r\n            this.position = options.position;\r\n        }\r\n        /**\r\n         * Scale\r\n         * @type {number}\r\n         */\r\n        this.lastScale = 1.0;\r\n        // Add Target Subscribe to this object\r\n        options.map.addSubscribeObject(this);\r\n    }\r\n    /**\r\n     * Free memory and remove vehicle from rendering\r\n     */\r\n    dispose() {\r\n        // https://github.com/mrdoob/three.js/blob/master/src/core/Object3D.js#L397\r\n        this.group.remove(this.head);\r\n        this.group.remove(this.line);\r\n        this._map.removeSubscribeObject(this);\r\n        this._map.scene.remove(this.group);\r\n        this._map = undefined;\r\n        this.group = undefined;\r\n        this.head.geometry.dispose();\r\n        this.head.material.dispose();\r\n        this.head = undefined;\r\n        this.line.geometry.dispose();\r\n        this.line.material.dispose();\r\n        this.line = undefined;\r\n        this._rGPosition = undefined;\r\n        this._rPosition = undefined;\r\n        this._position = undefined;\r\n    }\r\n    updateTarget(target) {\r\n        // Update rendering position\r\n        this._rPosition.subVectors(this._position, target);\r\n        // TODO: elevation projection instead of 0\r\n        this._rGPosition.set(this._rPosition.x, 0, this._rPosition.z);\r\n        (this.line.geometry as THREE.Geometry).verticesNeedUpdate = true;\r\n    }\r\n\r\n    get position() { return this._position; }\r\n    set position(p: any) {\r\n        if (!p) {\r\n            this._position.y = MapUtility.tenMeters();\r\n        } else {\r\n            // Case position is a QtPositioning.coordiante\r\n            if (p.longitude) {\r\n                sphericalMercator.CartographicToPixel(p, this._position);\r\n            } else {\r\n                this._position.copy(p);\r\n                // Default height is 10 meters\r\n                this._position.y = this._position.y || MapUtility.tenMeters();\r\n            }\r\n        }\r\n\r\n        // Restrict position above ground only\r\n        this._position.y = Math.max(this._position.y, 0);\r\n\r\n        // Update rendering position\r\n        // TODO: Is this._map needs\r\n        this._rPosition.subVectors(this._position, (this._map.camera.target as any));\r\n        // TODO: elevation projection instead of 0\r\n        this._rGPosition.set(this._rPosition.x, 0, this._rPosition.z);\r\n\r\n        (this.line.geometry as THREE.Geometry).verticesNeedUpdate = true;\r\n\r\n        this._map.cameraController.update();\r\n    }\r\n\r\n    coordinate() {\r\n        sphericalMercator.PixelToCartographic(this._position, this._coordinate);\r\n        return this._coordinate;\r\n    }\r\n\r\n    get height() { return this._position.y; }\r\n    set height(h) {\r\n        this._position.y = h;\r\n    }\r\n\r\n    get headAngle() {\r\n        return -this._headAngle * 180 / Math.PI;\r\n    }\r\n    set headAngle(angle) {\r\n        const angle_ = -angle * Math.PI / 180;\r\n        this.head.geometry.rotateY(angle_ - this._headAngle);\r\n        this._headAngle = angle_;\r\n    }\r\n\r\n    getScale() { return this.lastScale; }\r\n    setScale(s: number) {\r\n        if (this.lastScale === s) {\r\n            return;\r\n        }\r\n\r\n        this.head.geometry.scale(s / this.lastScale, s / this.lastScale, s / this.lastScale);\r\n        this.lastScale = s;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\n\r\nconst t = new Cartesian();\r\nconst s = new THREE.Vector3();\r\nconst corner = [[-1, -1], [-1, 1], [1, 1], [1, -1]];\r\n\r\nexport class Camera extends THREE.PerspectiveCamera {\r\n    _map: Map3D;\r\n\r\n    target = new Cartesian();\r\n    _targetCartographic = QtPositioning.coordinate();\r\n\r\n    _positionCartographic = QtPositioning.coordinate();\r\n\r\n    _culledGroundPlane: Cartesian[];\r\n\r\n    updatedLastFrame: boolean;\r\n    // FIXME: Debug\r\n    // geometry: THREE.Geometry;\r\n\r\n    constructor(options) {\r\n        super(70, options.canvas.width / options.canvas.height, 1 / 99, 12000000 / Math.sin(70 * Math.PI));\r\n\r\n        this._map = options.map;\r\n\r\n        this._targetCartographic = QtPositioning.coordinate();\r\n\r\n        this._positionCartographic = QtPositioning.coordinate();\r\n        this._culledGroundPlane = [new Cartesian(), new Cartesian(), new Cartesian(), new Cartesian()];\r\n        this.updatedLastFrame = false;\r\n        /**\r\n         * FIXME:\r\n         * Debuging mesh\r\n         */\r\n        // const material = new THREE.MeshBasicMaterial({\r\n        //     wireframe: true,\r\n        //     // opacity: 0,\r\n        //     color: new THREE.Color(0xff0000),\r\n        // });\r\n        // this.geometry = new THREE.Geometry();\r\n        // this.geometry.vertices = [\r\n        //     new THREE.Vector3(),\r\n        //     new THREE.Vector3(),\r\n        //     new THREE.Vector3(),\r\n        //     new THREE.Vector3(),\r\n        // ];\r\n        // this.geometry.faces = [\r\n        //     new THREE.Face3(0, 1, 3),\r\n        //     new THREE.Face3(1, 3, 2),\r\n        // ];\r\n        // this.geometry.computeFaceNormals();\r\n        // const mesh = new THREE.Mesh(this.geometry, material);\r\n        // this._map.scene.add(mesh);\r\n    }\r\n    setPosition(position) {\r\n        if (!position) {\r\n            throw new Error('No position provided');\r\n        }\r\n        // Partial set x, y, z of position\r\n        this.position.x = position.x || this.position.x;\r\n        this.position.y = position.y || this.position.y;\r\n        this.position.z = position.z || this.position.z;\r\n        sphericalMercator.PixelToCartographic(this.position, this._positionCartographic);\r\n        this.updatedLastFrame = true;\r\n    }\r\n    update() {\r\n        // Update Cartographic position\r\n        sphericalMercator.CartesianToCartographic(this.target, this._targetCartographic);\r\n        t.addVectors((this.target as any), this.position);\r\n        sphericalMercator.CartesianToCartographic(t, this._positionCartographic);\r\n        this.updatedLastFrame = true;\r\n        // Calculate ray direction at 4 corners of screen\r\n        let scale;\r\n        for (let i = 0; i < 4; i++) {\r\n            t.set(corner[i][0], corner[i][1], 0.5).unproject(this).sub(this.position).normalize();\r\n            // Case corner of camrea to over horizontal line direction from camera y axis will be positive\r\n            // It will not be able to project plane so will clip with -0\r\n            if (t.y >= 0) {\r\n                t.y = -0.00001;\r\n            }\r\n            scale = this.position.y / t.y;\r\n            s.subVectors(this.position, t.multiplyScalar(scale));\r\n            this._culledGroundPlane[i].set(s.x + this.target.x, 0, s.z + this.target.z);\r\n            // FIXME: Debugging\r\n            // this.geometry.vertices[i].set(s.x, 0, s.z);\r\n        }\r\n        // FIXME: Debugging\r\n        // this.geometry.verticesNeedUpdate = true;\r\n    }\r\n\r\n    get positionCartographic() {\r\n        return this._positionCartographic;\r\n    }\r\n\r\n    get targetCartographic() {\r\n        return this._targetCartographic;\r\n    }\r\n\r\n    get culledGroundPlane() {\r\n        return this._culledGroundPlane;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { MapSettings } from '../Core/MapSettings';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Camera } from './Camera';\r\n\r\nconst zero = new THREE.Vector3();\r\n// so camera.up is the orbit axis\r\nlet quat = new THREE.Quaternion();\r\nlet quatInverse = new THREE.Quaternion();\r\nconst EPS = 0.000001;\r\nconst v = new THREE.Vector3();\r\n\r\nexport class OrbitConstraint {\r\n    map: Map3D;\r\n    camera: Camera;\r\n    targetDistance: number;\r\n\r\n    minDistance: number;\r\n    maxDistance: number;\r\n\r\n    minPolarAngle: number = 0.0;\r\n    // maxPolarAngle: number = 0.48 * Math.PI;\r\n    maxPolarAngle: number = 0.3 * Math.PI;\r\n\r\n    minAzimuthAngle: number = -Infinity;\r\n    maxAzimuthAngle: number = Infinity;\r\n\r\n    enableDamping: boolean = true;\r\n    dampingFactor: number = 0.75;\r\n    maxClickTimeInterval: number = 500;\r\n\r\n    theta: number = 0.0;\r\n    phi: number = 0.0;\r\n    thetaDelta: number = 0.0;\r\n    phiDelta: number = 0.0;\r\n\r\n    scale: number = 1.0;\r\n\r\n    panOffset: THREE.Vector3 = new THREE.Vector3();\r\n    zoomChanged: boolean = false;\r\n\r\n    lastPosition: THREE.Vector3 = new THREE.Vector3();\r\n    lastQuaternion: THREE.Quaternion = new THREE.Quaternion();\r\n\r\n    constructor(map: Map3D, camera: Camera, targetDistance: number) {\r\n        this.map = map;\r\n        /**\r\n         * @type Camera\r\n         */\r\n        this.camera = camera;\r\n        /**\r\n         * @type number\r\n         */\r\n        this.targetDistance = targetDistance;\r\n\r\n        // Limits to how far you can dolly in and out ( PerspectiveCamera only )\r\n        this.minDistance = 0;\r\n        this.maxDistance = MapSettings.maxCameraDistance;\r\n\r\n        quat = quat.setFromUnitVectors(this.camera.up, new THREE.Vector3(0, 1, 0));\r\n        quatInverse = quat.clone().inverse();\r\n    }\r\n\r\n    getPolarAngle() {\r\n        return this.phi;\r\n    }\r\n\r\n    getAzimuthalAngle() {\r\n        return this.theta;\r\n    }\r\n    rotateLeft(angle) {\r\n        this.thetaDelta -= angle;\r\n        // TODO:\r\n        // compass.update();\r\n    }\r\n    rotateUp(angle) {\r\n        this.phiDelta -= angle;\r\n        // TODO:\r\n        // compass.update();\r\n    }\r\n\r\n    panLeft(distance) {\r\n        const te = this.camera.matrix.elements;\r\n        // get X column of matrix\r\n        v.set(te[0], te[1], te[2]);\r\n        v.multiplyScalar(-distance);\r\n        this.panOffset.add(v);\r\n    }\r\n    // pass in distance in world space to move up\r\n    panUp(distance) {\r\n        const te = this.camera.matrix.elements;\r\n        // get Y column of matrix\r\n        v.set(te[4], /* te[ 5 ] */ 0, te[6]);\r\n        v.multiplyScalar(distance);\r\n        this.panOffset.add(v);\r\n    }\r\n    // pass in x,y of change desired in pixel space,\r\n    // right and down are positive\r\n    pan(deltaX, deltaY, screenWidth, screenHeight) {\r\n        // half of the fov is center to top of screen\r\n        const t = this.targetDistance * Math.tan((this.camera.fov / 2) * Math.PI / 180.0);\r\n        // we actually don't use screenWidth, since perspective camera is fixed to screen height\r\n        this.panLeft(2 * deltaX * t / screenHeight);\r\n        this.panUp(2 * deltaY * t / screenHeight);\r\n    }\r\n\r\n    dollyIn(dollyScale) {\r\n        this.scale /= dollyScale;\r\n    }\r\n    dollyOut(dollyScale) {\r\n        this.scale *= dollyScale;\r\n    }\r\n\r\n    /**\r\n     * Update camera constrain\r\n     * @returns {boolean}\r\n     */\r\n    update() {\r\n        const offset = this.camera.position;\r\n        const target = this.camera.target;\r\n\r\n        this.theta += this.thetaDelta;\r\n        this.phi += this.phiDelta;\r\n        this.targetDistance = this.targetDistance * this.scale;\r\n        // Restrict theta to be between desired limits\r\n        this.theta = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, this.theta));\r\n        // Restrict phi to be between desired limits\r\n        this.phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, this.phi));\r\n        // Restrict phi to be betwee EPS and PI-EPS\r\n        this.phi = Math.max(EPS, Math.min(Math.PI - EPS, this.phi));\r\n        // Restrict radius to be between desired limits\r\n        this.targetDistance = Math.max(this.minDistance, Math.min(this.maxDistance, this.targetDistance));\r\n\r\n        // Move target to panned location\r\n        target.add(this.panOffset);\r\n        offset.x = this.targetDistance * Math.sin(this.phi) * Math.sin(this.theta);\r\n        offset.y = this.targetDistance * Math.cos(this.phi);\r\n        offset.z = this.targetDistance * Math.sin(this.phi) * Math.cos(this.theta);\r\n        // rotate offset back to \"camera-up-vector-is-up\" space\r\n        offset.applyQuaternion(quatInverse);\r\n        this.camera.lookAt(zero);\r\n        // Update camera matrix\r\n        this.camera.updateMatrix();\r\n        this.camera.updateMatrixWorld(true);\r\n        this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);\r\n        this.camera.update();\r\n        // Update subscribe object\r\n        this.map._subscribeObjects.forEach((obj) => { obj.updateTarget(target); });\r\n        if (this.enableDamping === true) {\r\n            this.thetaDelta *= (1.0 - this.dampingFactor);\r\n            this.phiDelta *= (1.0 - this.dampingFactor);\r\n        } else {\r\n            this.thetaDelta = 0.0;\r\n            this.phiDelta = 0.0;\r\n        }\r\n        this.scale = 1.0;\r\n        this.panOffset.set(0, 0, 0);\r\n        // update condition is:\r\n        // min(camera displacement, camera rotation in radians)^2 > EPS\r\n        // using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n        const t = new THREE.Vector3();\r\n        if (this.lastPosition.distanceToSquared(t.addVectors(this.camera.position,\r\n            (this.camera.target as any))) > EPS ||\r\n            8 * (1 - this.lastQuaternion.dot(this.camera.quaternion)) > EPS ||\r\n            this.zoomChanged) {\r\n            this.lastPosition.copy(t);\r\n            this.lastQuaternion.copy(this.camera.quaternion);\r\n            this.zoomChanged = false;\r\n            if (this.map.quadTree) {\r\n                this.map.quadTree.needUpdate = true;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get target() {\r\n        return this.camera.target;\r\n    }\r\n    set target(target) {\r\n        this.camera.target = target;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Map3D } from '../Core/Map3D';\r\nimport { MapSettings } from '../Core/MapSettings';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Camera } from '../Renderer/Camera';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { OrbitConstraint } from './OrbitConstraint';\r\n\r\nexport interface OrbitControlsOptions {\r\n    map: Map3D;\r\n    eventSource: QtEventSource;\r\n    canvas: QtCanvas;\r\n}\r\n\r\nfunction compare(modifiers) {\r\n    if (typeof Qt === 'object') {\r\n        return modifiers & Qt.ControlModifier;\r\n    }\r\n\r\n    return modifiers;\r\n}\r\n\r\nfunction getAutoRotationAngle(primitive: OrbitControls) {\r\n    return 2 * Math.PI / 60 / 60 * primitive.autoRotateSpeed;\r\n}\r\n\r\nfunction getZoomScale(delta?: number) {\r\n    delta = delta || 1;\r\n    return Math.pow(0.999, delta);\r\n}\r\n\r\nconst screenPosition = new THREE.Vector2();\r\nconst picker = new THREE.Raycaster();\r\nconst px = new THREE.Vector3();\r\n\r\nfunction pickerFromScreen(primitive, x, y, p) {\r\n    screenPosition.set((x / primitive.canvas.width) * 2 - 1, -(y / primitive.canvas.height) * 2 + 1);\r\n    p.setFromCamera(screenPosition, primitive.camera);\r\n\r\n    return p;\r\n}\r\n\r\nfunction contextmenu(event) {\r\n    event.preventDefault();\r\n}\r\n\r\nexport class OrbitControls extends THREE.EventDispatcher {\r\n    static STATE = { NONE: -1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\r\n    static MODE = { NONE: -1, GUIDE: 0 };\r\n\r\n    _map: Map3D;\r\n\r\n    constraint: OrbitConstraint;\r\n    eventSource: QtEventSource;\r\n    canvas: QtCanvas;\r\n\r\n    enabled: boolean;\r\n\r\n    enableZoom: boolean;\r\n    zoomSpeed: number;\r\n\r\n    enableRotate: boolean;\r\n    rotateSpeed: number;\r\n\r\n    enablePan: boolean;\r\n    keyPanSpeed: number;\r\n\r\n    autoRotate: boolean;\r\n    autoRotateSpeed: number;\r\n\r\n    enableKeys: boolean;\r\n    keys: { LEFT: any; UP: number; RIGHT: number; BOTTOM: number; };\r\n    mouseButtons: { ORBIT: number; ZOOM: number; PAN: number; };\r\n\r\n    _state: number;\r\n    _lastClick: number;\r\n\r\n    _isMouseDown: boolean;\r\n\r\n    _mode: number;\r\n\r\n    keyDown: any;\r\n\r\n    zoom0: number;\r\n    position0: THREE.Vector3;\r\n    target0: Cartesian;\r\n\r\n    dispose: () => void;\r\n\r\n    constructor(options: OrbitControlsOptions) {\r\n        super();\r\n\r\n        this._map = options.map;\r\n\r\n        this.constraint = new OrbitConstraint(this._map, this._map.camera, MapSettings.cameraDistance);\r\n        this.eventSource = options.eventSource;\r\n        this.canvas = options.canvas;\r\n\r\n        // Set to false to disable this control\r\n        this.enabled = true;\r\n        // This option actually enables dollying in and out; left as \"zoom\" for\r\n        // backwards compatibility.\r\n        // Set to false to disable zooming\r\n        this.enableZoom = true;\r\n        this.zoomSpeed = 10;\r\n        // Set to false to disable rotating\r\n        this.enableRotate = true;\r\n        this.rotateSpeed = 1.0;\r\n        // Set to false to disable panning\r\n        this.enablePan = true;\r\n        this.keyPanSpeed = 5.0; // pixels moved per arrow key push\r\n        // Set to true to automatically rotate around the target\r\n        // If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n        this.autoRotate = false;\r\n        this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n        // Set to false to disable use of the keys\r\n        this.enableKeys = true;\r\n        // The four arrow keys\r\n        this.keys = typeof Qt === 'object'\r\n            ? { LEFT: Qt.LeftArrow, UP: Qt.UpArrow, RIGHT: Qt.RightArrow, BOTTOM: Qt.DownArrow }\r\n            : { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n        // Mouse buttons\r\n        this.mouseButtons = { ORBIT: THREE.MOUSE.RIGHT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.LEFT };\r\n        /// /////////\r\n        // internals\r\n        const scope = this;\r\n        const rotateStart = new THREE.Vector2();\r\n        const rotateEnd = new THREE.Vector2();\r\n        const rotateDelta = new THREE.Vector2();\r\n        const panStart = new THREE.Vector2();\r\n        const panEnd = new THREE.Vector2();\r\n        const panDelta = new THREE.Vector2();\r\n        const dollyStart = new THREE.Vector2();\r\n        const dollyEnd = new THREE.Vector2();\r\n        const dollyDelta = new THREE.Vector2();\r\n        /**\r\n         * State\r\n         */\r\n        this._state = OrbitControls.STATE.NONE;\r\n        this._lastClick = null;\r\n        /**\r\n         * Is mouse down\r\n         * @type {boolean}\r\n         */\r\n        this._isMouseDown = false;\r\n        this._mode = OrbitControls.MODE.NONE;\r\n\r\n        const currentPin = null;\r\n        let intersected = null;\r\n        // set start position\r\n        // TODO: using property instead of location\r\n        // setView(this, location.hash)\r\n\r\n        // for reset\r\n        this.target0 = this.target.clone();\r\n        this.position0 = this.camera.position.clone();\r\n        this.zoom0 = this.camera.zoom;\r\n\r\n        // pass in x,y of change desired in pixel space,\r\n        // right and down are positive\r\n        const pan = (deltaX, deltaY) => {\r\n            scope.constraint.pan(deltaX, deltaY, scope.canvas.width, scope.canvas.height);\r\n        };\r\n\r\n        // this.moveTo = function (coords, currentHeight) {\r\n        //     this.target.copy(coords);\r\n        //     this.camera.position.copy({x: coords.x, y: currentHeight, z: coords.z});\r\n        //     // TIMER: timer.\r\n        //     if (typeof Qt === 'object') {\r\n        //         timer.setTimeout(function () { map.quadTree.needUpdate = true; }, 10);\r\n        //     } else {\r\n        //         setTimeout(function () { map.quadTree.needUpdate = true; }, 10);\r\n        //     }\r\n        // };\r\n\r\n        function onMouseDown(x, y, button, modifiers) {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            if (button === scope.mouseButtons.ORBIT || compare(modifiers)) {\r\n                if (scope.enableRotate === false) {\r\n                    return;\r\n                }\r\n                scope._state = OrbitControls.STATE.ROTATE;\r\n                rotateStart.set(x, y);\r\n            } else if (button === scope.mouseButtons.ZOOM) {\r\n                if (scope.enableZoom === false) {\r\n                    return;\r\n                }\r\n                scope._state = OrbitControls.STATE.DOLLY;\r\n                dollyStart.set(x, y);\r\n            } else if (button === scope.mouseButtons.PAN) {\r\n                // Checking mouse down on marker\r\n                // TODO: Use mission method to handle object\r\n                if (!scope._map.currentMission.onMouseDown(scope, x, y, button)) {\r\n                    panStart.set(x, y);\r\n                    scope._lastClick = Date.now();\r\n                }\r\n            }\r\n            scope._isMouseDown = true;\r\n        }\r\n        function onWebMouseDown(event) {\r\n            event.preventDefault();\r\n            onMouseDown(event.clientX, event.clientY, event.button, event.ctrlKey);\r\n        }\r\n\r\n        function onMouseMove(x, y) {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            const now = Date.now();\r\n            if (scope._lastClick) {\r\n                panEnd.set(x, y);\r\n                panDelta.subVectors(panEnd, panStart);\r\n                if (scope._isMouseDown && now - scope._lastClick <= 500 &&\r\n                    Math.abs(panDelta.x) + Math.abs(panDelta.y) > 10 && scope.enablePan) {\r\n                    if (scope._mode === OrbitControls.MODE.GUIDE) {\r\n                        scope.target0.set(scope.target.x, 0, scope.target.z);\r\n                        scope.constraint.target = scope.target0;\r\n                        scope._mode = OrbitControls.MODE.NONE;\r\n                    }\r\n                    scope._state = OrbitControls.STATE.PAN;\r\n                    scope._lastClick = null;\r\n                } else if (now - scope._lastClick > 500) {\r\n                    scope._lastClick = null;\r\n                }\r\n            }\r\n            if (scope._state === OrbitControls.STATE.NONE) {\r\n                // Hovering Rendering Object\r\n                MapUtility.rayCasterFromScreen(scope, x, y, picker);\r\n                const intersects = picker.intersectObjects(scope._map.currentMission.interactableObjects(), true);\r\n                if (intersects.length > 0) {\r\n                    const targetObject = intersects[0].object;\r\n                    if (targetObject !== intersected) {\r\n                        if (intersected) {\r\n                            intersected.material.opacity = intersected.currentOpacity;\r\n                        }\r\n                        intersected = targetObject;\r\n                        intersected.currentOpacity = intersected.material.opacity;\r\n                        intersected.material.opacity = 1.0;\r\n                    }\r\n                } else if (intersected) {\r\n                    intersected.material.opacity = intersected.currentOpacity;\r\n                    delete intersected.currentOpacity;\r\n                    intersected = null;\r\n                }\r\n            } else if (scope._state === OrbitControls.STATE.ROTATE) {\r\n                if (scope.enableRotate === false) {\r\n                    return;\r\n                }\r\n                rotateEnd.set(x, y);\r\n                rotateDelta.subVectors(rotateEnd, rotateStart);\r\n                // rotating across whole screen goes 360 degrees around\r\n                scope.constraint.rotateLeft(2 * Math.PI * rotateDelta.x / scope.canvas.width * scope.rotateSpeed);\r\n                // rotating up and down along whole screen attempts to go 360, but limited to 180\r\n                scope.constraint.rotateUp(2 * Math.PI * rotateDelta.y / scope.canvas.height * scope.rotateSpeed);\r\n                rotateStart.copy(rotateEnd);\r\n            } else if (scope._state === OrbitControls.STATE.DOLLY) {\r\n                if (scope.enableZoom === false) {\r\n                    return;\r\n                }\r\n                dollyEnd.set(x, y);\r\n                dollyDelta.subVectors(dollyEnd, dollyStart);\r\n                if (dollyDelta.y > 0) {\r\n                    scope.constraint.dollyIn(getZoomScale());\r\n                } else if (dollyDelta.y < 0) {\r\n                    scope.constraint.dollyOut(getZoomScale());\r\n                }\r\n                dollyStart.copy(dollyEnd);\r\n            } else if (scope._state === OrbitControls.STATE.PAN) {\r\n                if (scope.enablePan === false) {\r\n                    return;\r\n                }\r\n                panEnd.set(x, y);\r\n                panDelta.subVectors(panEnd, panStart);\r\n                pan(panDelta.x, panDelta.y);\r\n                panStart.copy(panEnd);\r\n            } else if (!scope._map.currentMission.onMouseMove(scope, x, y)) {\r\n                // TODO:\r\n            }\r\n            if (scope._state !== OrbitControls.STATE.NONE) {\r\n                scope.update();\r\n            }\r\n        }\r\n        function onWebMouseMove(event) {\r\n            event.preventDefault();\r\n            onMouseMove(event.clientX, event.clientY);\r\n        }\r\n\r\n        function onMouseUp(x, y) {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            // if (!scope._isMouseDown) return;\r\n            scope._isMouseDown = false;\r\n            scope._state = OrbitControls.STATE.NONE;\r\n        }\r\n        function onWebMouseUp(event) {\r\n            event.preventDefault();\r\n            onMouseUp(event.clientX, event.clientY);\r\n        }\r\n\r\n        function onMouseWheel(x, y, wheelX, wheelY) {\r\n            // if ( scope.enabled === false || scope.enableZoom === false || state !== STATE.NONE ) return;\r\n            const delta = wheelY;\r\n            scope.constraint.dollyOut(getZoomScale(delta));\r\n            scope.update();\r\n            // scope.dispatchEvent(startEvent);\r\n            // scope.dispatchEvent(endEvent);\r\n            // off-center zooming :D\r\n            if (scope.camera.position.y >= scope.maxDistance) {\r\n                return;\r\n            }\r\n            const direction = -delta * 0.001001001;\r\n            pan(direction * (x - scope.canvas.width / 2), direction * (y - scope.canvas.height / 2));\r\n        }\r\n        function onWebMouseWheel(event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            if (event.wheelDelta !== undefined) {\r\n                // WebKit / Opera / Explorer 9\r\n                onMouseWheel(event.clientX, event.clientY, 0, event.wheelDelta);\r\n            } else if (event.detail !== undefined) {\r\n                // Firefox\r\n                onMouseWheel(event.clientX, event.clientY, 0, -event.detail);\r\n            }\r\n        }\r\n        function onKeyDown(event) {\r\n            if (scope.keyDown || scope.enabled === false || scope.enableKeys === false || scope.enablePan === false) {\r\n                return;\r\n            }\r\n            scope.keyDown = // TODO: timer.\r\n                setInterval(() => {\r\n                    switch (event.key) {\r\n                        case scope.keys.UP:\r\n                            pan(0, scope.keyPanSpeed);\r\n                            scope.update();\r\n                            break;\r\n                        case scope.keys.BOTTOM:\r\n                            pan(0, -scope.keyPanSpeed);\r\n                            scope.update();\r\n                            break;\r\n                        case scope.keys.LEFT:\r\n                            pan(scope.keyPanSpeed, 0);\r\n                            scope.update();\r\n                            break;\r\n                        case scope.keys.RIGHT:\r\n                            pan(-scope.keyPanSpeed, 0);\r\n                            scope.update();\r\n                            break;\r\n                    }\r\n                }, 10);\r\n        }\r\n        function onKeyUp(event) {\r\n            // TIMER: timer.\r\n            if (typeof Qt === 'object') {\r\n                timer.clearInterval(scope.keyDown);\r\n            } else {\r\n                clearInterval(scope.keyDown);\r\n            }\r\n            scope.keyDown = false;\r\n        }\r\n        function touchstart(event) {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            switch (event.touches.length) {\r\n                case 1: // one-fingered touch: rotate\r\n                    if (scope.enableRotate === false) {\r\n                        return;\r\n                    }\r\n                    scope._state = OrbitControls.STATE.TOUCH_ROTATE;\r\n                    rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n                    break;\r\n                case 2: // two-fingered touch: dolly\r\n                    if (scope.enableZoom === false) {\r\n                        return;\r\n                    }\r\n                    scope._state = OrbitControls.STATE.TOUCH_DOLLY;\r\n                    const dx = event.touches[0].pageX - event.touches[1].pageX;\r\n                    const dy = event.touches[0].pageY - event.touches[1].pageY;\r\n                    const distance = Math.sqrt(dx * dx + dy * dy);\r\n                    dollyStart.set(0, distance);\r\n                    break;\r\n                case 3: // three-fingered touch: pan\r\n                    if (scope.enablePan === false) {\r\n                        return;\r\n                    }\r\n                    scope._state = OrbitControls.STATE.TOUCH_PAN;\r\n                    panStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n                    break;\r\n                default:\r\n                    scope._state = OrbitControls.STATE.NONE;\r\n            }\r\n        }\r\n        function touchmove(event) {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            const element = (scope._map._renderer.domElement as any) === document ?\r\n                (scope._map._renderer.domElement as any).body : scope._map._renderer.domElement;\r\n            switch (event.touches.length) {\r\n                case 1: // one-fingered touch: rotate\r\n                    if (scope.enableRotate === false) {\r\n                        return;\r\n                    }\r\n                    if (scope._state !== OrbitControls.STATE.TOUCH_ROTATE) {\r\n                        return;\r\n                    }\r\n                    rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n                    rotateDelta.subVectors(rotateEnd, rotateStart);\r\n                    // rotating across whole screen goes 360 degrees around\r\n                    scope.constraint.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed);\r\n                    // rotating up and down along whole screen attempts to go 360, but limited to 180\r\n                    scope.constraint.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\r\n                    rotateStart.copy(rotateEnd);\r\n                    scope.update();\r\n                    break;\r\n                case 2: // two-fingered touch: dolly\r\n                    if (scope.enableZoom === false) {\r\n                        return;\r\n                    }\r\n                    if (scope._state !== OrbitControls.STATE.TOUCH_DOLLY) {\r\n                        return;\r\n                    }\r\n                    const dx = event.touches[0].pageX - event.touches[1].pageX;\r\n                    const dy = event.touches[0].pageY - event.touches[1].pageY;\r\n                    const distance = Math.sqrt(dx * dx + dy * dy);\r\n                    dollyEnd.set(0, distance);\r\n                    dollyDelta.subVectors(dollyEnd, dollyStart);\r\n                    if (dollyDelta.y > 0) {\r\n                        scope.constraint.dollyOut(getZoomScale());\r\n                    } else if (dollyDelta.y < 0) {\r\n                        scope.constraint.dollyIn(getZoomScale());\r\n                    }\r\n                    dollyStart.copy(dollyEnd);\r\n                    scope.update();\r\n                    break;\r\n                case 3: // three-fingered touch: pan\r\n                    if (scope.enablePan === false) {\r\n                        return;\r\n                    }\r\n                    if (scope._state !== OrbitControls.STATE.TOUCH_PAN) {\r\n                        return;\r\n                    }\r\n                    panEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n                    panDelta.subVectors(panEnd, panStart);\r\n                    pan(panDelta.x, panDelta.y);\r\n                    panStart.copy(panEnd);\r\n                    scope.update();\r\n                    break;\r\n                default:\r\n                    scope._state = OrbitControls.STATE.NONE;\r\n            }\r\n        }\r\n        function touchend() {\r\n            if (scope.enabled === false) {\r\n                return;\r\n            }\r\n            // scope.dispatchEvent(endEvent);\r\n            scope._state = OrbitControls.STATE.NONE;\r\n        }\r\n        this.dispose = function() {\r\n            if (typeof Qt === 'object') {\r\n                scope.eventSource.mouseDown.disconnect(onMouseDown);\r\n                scope.eventSource.mouseMove.disconnect(onMouseMove);\r\n                this.eventSource.mouseMove.disconnect(onMouseUp);\r\n                scope.eventSource.mouseWheel.disconnect(onMouseWheel);\r\n                scope.eventSource.keyDown.disconnect(onKeyDown);\r\n            } else {\r\n                this._map._renderer.domElement.removeEventListener('contextmenu', contextmenu, false);\r\n                this._map._renderer.domElement.removeEventListener('mousedown', onWebMouseDown, false);\r\n                this._map._renderer.domElement.removeEventListener('mouseup', onWebMouseUp, false);\r\n                this._map._renderer.domElement.removeEventListener('mousemove', onWebMouseMove, false);\r\n                this._map._renderer.domElement.removeEventListener('mousewheel', onWebMouseWheel, false);\r\n                this._map._renderer.domElement.removeEventListener('touchstart', touchstart, false);\r\n                this._map._renderer.domElement.removeEventListener('touchend', touchend, false);\r\n                this._map._renderer.domElement.removeEventListener('touchmove', touchmove, false);\r\n            }\r\n        };\r\n        // this.domElement.addEventListener( 'contextmenu', contextmenu, false );\r\n        if (typeof Qt === 'object') {\r\n            this.eventSource.mouseDown.connect(onMouseDown);\r\n            this.eventSource.mouseMove.connect(onMouseMove);\r\n            this.eventSource.mouseUp.connect(onMouseUp);\r\n            this.eventSource.mouseWheel.connect(onMouseWheel);\r\n            this.eventSource.keyDown.connect(onKeyDown);\r\n            this.eventSource.keyUp.connect(onKeyUp);\r\n        } else {\r\n            this._map._renderer.domElement.addEventListener('mousedown', onWebMouseDown, false);\r\n            this._map._renderer.domElement.addEventListener('mousemove', onWebMouseMove, false);\r\n            this._map._renderer.domElement.addEventListener('mouseup', onWebMouseUp, false);\r\n            this._map._renderer.domElement.addEventListener('mousewheel', onWebMouseWheel, false);\r\n            this._map._renderer.domElement.addEventListener('touchstart', touchstart, false);\r\n            this._map._renderer.domElement.addEventListener('touchend', touchend, false);\r\n            this._map._renderer.domElement.addEventListener('touchmove', touchmove, false);\r\n        }\r\n        // force an update at start\r\n        this.update();\r\n    }\r\n\r\n    getPolarAngle() {\r\n        return this.constraint.getPolarAngle();\r\n    }\r\n    getAzimuthalAngle() {\r\n        return this.constraint.getAzimuthalAngle();\r\n    }\r\n    update() {\r\n        // Pause camera when debuging\r\n        if (this._map.quadTree && this._map.quadTree._debug.suspendLodUpdate) {\r\n            return;\r\n        }\r\n        if (this.autoRotate && this._state === OrbitControls.STATE.NONE) {\r\n            this.constraint.rotateLeft(getAutoRotationAngle(this));\r\n        }\r\n        if (this.constraint.update() === true) {\r\n            // this.dispatchEvent(changeEvent);\r\n        }\r\n    }\r\n    reset() {\r\n        this._state = OrbitControls.STATE.NONE;\r\n        this.camera.target.copy(this.target0);\r\n        this.camera.position.copy(this.position0);\r\n        this.camera.zoom = this.zoom0;\r\n        this.camera.updateProjectionMatrix();\r\n        // this.dispatchEvent(changeEvent);\r\n        this.update();\r\n    }\r\n    /**\r\n     * Set camrea view\r\n     * @param {Cartographic} position - Cartographic position\r\n     * @param {number} zoom - Zoom distance\r\n     * @param {number} duration\r\n     */\r\n    setView(position: Cartographic, zoom: number, duration?: number) {\r\n        // TODO: duration as animation\r\n        duration = duration || 0;\r\n        sphericalMercator.CartographicToPixel(position, px);\r\n        // FIXME: Y = elevation data\r\n        this.constraint.camera.target.set(px.x, 0, px.z);\r\n        this.constraint.targetDistance = Math.pow(0.5, zoom) * MapSettings.cameraDistance;\r\n        this.update();\r\n        // camera.matrixWorldInverse.getInverse(camera.matrixWorld);\r\n        // this.quadTree.needUpdate = true;\r\n    }\r\n    guide(vehicle) {\r\n        this._mode = OrbitControls.MODE.GUIDE;\r\n        this.target0 = this.constraint.target.clone();\r\n        this.constraint.target = vehicle.position;\r\n        this.constraint.targetDistance = vehicle.height * 2;\r\n        this.update();\r\n    }\r\n\r\n    get camera() { return this.constraint.camera; }\r\n    get target() { return this.constraint.target; }\r\n    get minDistance() { return this.constraint.minDistance; }\r\n    set minDistance(value) { this.constraint.minDistance = value; }\r\n    get maxDistance() { return this.constraint.maxDistance; }\r\n    set maxDistance(value) { this.constraint.maxDistance = value; }\r\n    // get minZoom() { return this.constraint.minZoom; }\r\n    // set minZoom(value) { this.constraint.minZoom = value; }\r\n    // get maxZoom() { return this.constraint.maxZoom; }\r\n    // set maxZoom(value) { this.constraint.maxZoom = value; }\r\n    get minPolarAngle() { return this.constraint.minPolarAngle; }\r\n    set minPolarAngle(value) { this.constraint.minPolarAngle = value; }\r\n    get maxPolarAngle() { return this.constraint.maxPolarAngle; }\r\n    set maxPolarAngle(value) { this.constraint.maxPolarAngle = value; }\r\n    get minAzimuthAngle() { return this.constraint.minAzimuthAngle; }\r\n    set minAzimuthAngle(value) { this.constraint.minAzimuthAngle = value; }\r\n    get maxAzimuthAngle() { return this.constraint.maxAzimuthAngle; }\r\n    set maxAzimuthAngle(value) { this.constraint.maxAzimuthAngle = value; }\r\n    get enableDamping() { return this.constraint.enableDamping; }\r\n    set enableDamping(value) { this.constraint.enableDamping = value; }\r\n    get dampingFactor() { return this.constraint.dampingFactor; }\r\n    set dampingFactor(value) { this.constraint.dampingFactor = value; }\r\n}\r\n","const eps = 0.0000001;\r\nfunction between(a, b, c) {\r\n    return a - eps <= b && b <= c + eps;\r\n}\r\n\r\nexport class GeometricHelper {\r\n    static pointInsidePolygon(polygon, pt) {\r\n        // Ray-casting algorithm only 2D x-z\r\n        const x = pt.x;\r\n        const z = pt.z;\r\n        let inside = false;\r\n        for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\r\n            const xi = polygon[i].x;\r\n            const zi = polygon[i].z;\r\n            const xj = polygon[j].x;\r\n            const zj = polygon[j].z;\r\n\r\n            const intersect = ((zi >= z) !== (zj >= z)) &&\r\n                (x < (xj - xi) * (z - zi) / (zj - zi) + xi);\r\n            if (intersect) {\r\n                inside = !inside;\r\n            }\r\n        }\r\n\r\n        return inside;\r\n\r\n        // return inside([pt.x, pt.z], polygon.map(function (p) { return [p.x, p.z]; }));\r\n\r\n        // return classifyPoint(polygon.map(function (p) { return [p.x, p.z]; }), [pt.x, pt.z]) < 1;\r\n    }\r\n\r\n    static lineIntersects(l1, l2) {\r\n        const a = l1[0].x;\r\n        const b = l1[0].z;\r\n        const c = l1[1].x;\r\n        const d = l1[1].z;\r\n        const p = l2[0].x;\r\n        const q = l2[0].z;\r\n        const r = l2[1].x;\r\n        const s = l2[1].z;\r\n        let det;\r\n        let gamma;\r\n        let lambda;\r\n        det = (c - a) * (s - q) - (r - p) * (d - b);\r\n        if (det === 0) {\r\n          return false;\r\n        } else {\r\n          lambda = ((s - q) * (r - a) + (p - r) * (s - b)) / det;\r\n          gamma = ((b - d) * (r - a) + (c - a) * (s - b)) / det;\r\n          return (0 < lambda && lambda < 1) && (0 < gamma && gamma < 1);\r\n        }\r\n        // const x = ((x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4)) /\r\n        //         ((x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4));\r\n        // const y = ((x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4)) /\r\n        //         ((x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4));\r\n        // if (isNaN(x) || isNaN(y)) {\r\n        //     return false;\r\n        // } else {\r\n        //     if (x1 >= x2) {\r\n        //         if (!between(x2, x, x1)) { return false; }\r\n        //     } else {\r\n        //         if (!between(x1, x, x2)) { return false; }\r\n        //     }\r\n        //     if (y1 >= y2) {\r\n        //         if (!between(y2, y, y1)) { return false; }\r\n        //     } else {\r\n        //         if (!between(y1, y, y2)) { return false; }\r\n        //     }\r\n        //     if (x3 >= x4) {\r\n        //         if (!between(x4, x, x3)) { return false; }\r\n        //     } else {\r\n        //         if (!between(x3, x, x4)) { return false; }\r\n        //     }\r\n        //     if (y3 >= y4) {\r\n        //         if (!between(y4, y, y3)) { return false; }\r\n        //     } else {\r\n        //         if (!between(y3, y, y4)) { return false; }\r\n        //     }\r\n        // }\r\n        // return true;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { TileConstructor } from '../SceneMode/Tile';\r\n\r\nexport interface PoolOptions {\r\n    instance: TileConstructor;\r\n    size?: number;\r\n}\r\n\r\nexport class Pool {\r\n    _length: number;\r\n    _usingNodes: { [key: string]: THREE.Mesh };\r\n    _freeNodes: THREE.Mesh[];\r\n    create: () => THREE.Mesh;\r\n\r\n    constructor(options: PoolOptions) {\r\n        this._length = options.size || 16;\r\n        this._usingNodes = {};\r\n        this._freeNodes = [];\r\n\r\n        this.create = options.instance.createMesh;\r\n\r\n        for (let i = 0; i < this._length; i++) {\r\n            this._freeNodes.push(this.create());\r\n        }\r\n    }\r\n    duplicate() {\r\n        const length = this._length;\r\n        for (let i = 0; i < length; i++) {\r\n            this._freeNodes.push(this.create());\r\n        }\r\n        this._length *= 2;\r\n    }\r\n    get(index: string) {\r\n        if (!this._usingNodes[index]) {\r\n            throw new Error(`${index} isn't in used.`);\r\n        }\r\n        return this._usingNodes[index];\r\n    }\r\n    use(index: string) {\r\n        const node = this._freeNodes.pop();\r\n        this._usingNodes[index] = node;\r\n        return node;\r\n    }\r\n    free(index: string) {\r\n        const node = this._usingNodes[index];\r\n        delete this._usingNodes[index];\r\n        this._freeNodes.push(node);\r\n    }\r\n\r\n    get length() {\r\n        return this._length;\r\n    }\r\n}\r\n","import { Tile } from '../SceneMode/Tile';\r\n\r\nexport class TileReplacementQueue {\r\n    head: Tile;\r\n    tail: Tile;\r\n    count: number;\r\n    _lastBeforeStartOfFrame: Tile;\r\n\r\n    constructor() {\r\n        this.head = undefined;\r\n        this.tail = undefined;\r\n        this.count = 0;\r\n        this._lastBeforeStartOfFrame = undefined;\r\n    }\r\n    /**\r\n     * Marks the start of the render frame.  Tiles before (closer to the head) this tile in the\r\n     * list were used last frame and must not be unloaded.\r\n     */\r\n    markStartOfRenderFrame() {\r\n        this._lastBeforeStartOfFrame = this.head;\r\n    }\r\n    /**\r\n     * Reduces the size of the queue to a specified size by unloading the least-recently used\r\n     * tiles.  Tiles that were used last frame will not be unloaded, even if that puts the number\r\n     * of tiles above the specified maximum.\r\n     *\r\n     * @param {Number} maximumTiles The maximum number of tiles in the queue.\r\n     */\r\n    trimTiles(maximumTiles: number) {\r\n        let tileToTrim = this.tail;\r\n        let keepTrimming = true;\r\n        while (keepTrimming &&\r\n            this._lastBeforeStartOfFrame &&\r\n            this.count > maximumTiles &&\r\n            tileToTrim) {\r\n            // Stop trimming after we process the last tile not used in the\r\n            // current frame.\r\n            keepTrimming = tileToTrim !== this._lastBeforeStartOfFrame;\r\n\r\n            const previous = tileToTrim.replacementPrevious;\r\n\r\n            if (tileToTrim.eligibleForUnloading) {\r\n                remove(this, tileToTrim);\r\n                tileToTrim.dispose();\r\n            }\r\n            tileToTrim = previous;\r\n        }\r\n\r\n        // if (this.count > maximumTiles) {\r\n        // let tileToTrim2 = this.tail;\r\n        // while(tileToTrim2) {\r\n        //     const previous = tileToTrim2.replacementPrevious;\r\n        //     console.log(tileToTrim2.stringify, tileToTrim2.quadTree._activeTiles.indexOf(tileToTrim2))\r\n        //     tileToTrim2 = previous;\r\n        // }\r\n        // }\r\n    }\r\n\r\n    markTileRendered(item: Tile) {\r\n        const head = this.head;\r\n        if (head === item) {\r\n            if (item === this._lastBeforeStartOfFrame) {\r\n                this._lastBeforeStartOfFrame = item.replacementNext;\r\n            }\r\n            return;\r\n        }\r\n        ++this.count;\r\n        if (!head) {\r\n            // no other tiles in the list\r\n            item.replacementPrevious = undefined;\r\n            item.replacementNext = undefined;\r\n            this.head = item;\r\n            this.tail = item;\r\n            return;\r\n        }\r\n        if (item.replacementPrevious || item.replacementNext) {\r\n            // tile already in the list, remove from its current location\r\n            remove(this, item);\r\n        }\r\n        item.replacementPrevious = undefined;\r\n        item.replacementNext = head;\r\n        head.replacementPrevious = item;\r\n\r\n        this.head = item;\r\n    }\r\n}\r\n\r\nfunction remove(tileReplacementQueue: TileReplacementQueue, item: Tile) {\r\n    const previous = item.replacementPrevious;\r\n    const next = item.replacementNext;\r\n\r\n    if (item === tileReplacementQueue._lastBeforeStartOfFrame) {\r\n        tileReplacementQueue._lastBeforeStartOfFrame = next;\r\n    }\r\n\r\n    if (item === tileReplacementQueue.head) {\r\n        tileReplacementQueue.head = next;\r\n    } else {\r\n        previous.replacementNext = next;\r\n    }\r\n\r\n    if (item === tileReplacementQueue.tail) {\r\n        tileReplacementQueue.tail = previous;\r\n    } else {\r\n        next.replacementPrevious = previous;\r\n    }\r\n\r\n    item.replacementPrevious = undefined;\r\n    item.replacementNext = undefined;\r\n\r\n    --tileReplacementQueue.count;\r\n}\r\n","import * as THREE from 'three';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Camera } from '../Renderer/Camera';\r\nimport { OrbitControls } from '../Renderer/OrbitControls';\r\nimport { SceneMode } from '../SceneMode/SceneMode';\r\nimport { Tile, TileConstructor } from '../SceneMode/Tile';\r\nimport { GeometricHelper } from '../Utility/GeometricHelper';\r\nimport { Map3D } from './Map3D';\r\nimport { Pool } from './Pool';\r\nimport { TileReplacementQueue } from './TileReplacementQueue';\r\nimport { TilingScheme } from './TilingScheme';\r\n\r\nexport interface QuadTreeOptions {\r\n    map: Map3D;\r\n    mode: SceneMode;\r\n    maximumScreenSpaceError?: number;\r\n    tileCacheSize?: number;\r\n}\r\n\r\nexport class QuadTree {\r\n    _map: Map3D;\r\n\r\n    scene: THREE.Scene;\r\n    tiles: THREE.Group;\r\n\r\n    camera: Camera;\r\n    cameraController: OrbitControls;\r\n\r\n    mode: SceneMode;\r\n\r\n    _rootTile: Tile[];\r\n    _activeTiles: Tile[];\r\n    _tileLoadQueueHigh: Tile[];\r\n    _tileLoadQueueMedium: Tile[];\r\n    _tileLoadQueueLow: Tile[];\r\n\r\n    _tileReplacementQueue: TileReplacementQueue;\r\n\r\n    _loadQueueTimeSlice: number;\r\n\r\n    maximumScreenSpaceError: number;\r\n\r\n    tileCacheSize: number;\r\n\r\n    maxDepth: number;\r\n\r\n    _lastTileLoadQueueLength: number;\r\n\r\n    needUpdate: boolean;\r\n\r\n    _debug: {\r\n        enableDebugOutput: boolean;\r\n        maxDepth: number;\r\n        tilesVisited: number;\r\n        tilesCulled: number;\r\n        tilesRendered: number;\r\n        tilesWaitingForChildren: number;\r\n        lastMaxDepth: number;\r\n        lastTilesVisited: number;\r\n        lastTilesCulled: number;\r\n        lastTilesRendered: number;\r\n        lastTilesWaitingForChildren: number;\r\n        suspendLodUpdate: boolean;\r\n    };\r\n\r\n    _pool: Pool;\r\n\r\n    constructor(options: QuadTreeOptions) {\r\n        this._map = options.map;\r\n\r\n        this.scene = options.map.scene;\r\n\r\n        this.tiles = new THREE.Group();\r\n        this.tiles.name = 'Tiles';\r\n        this.scene.add(this.tiles);\r\n\r\n        this.cameraController = options.map.cameraController;\r\n        this.camera = options.map.camera;\r\n\r\n        this._rootTile = options.mode.createRootTile(this);\r\n        /**\r\n         * Scene mode\r\n         * @type {SceneMode}\r\n         */\r\n        this.mode = options.mode;\r\n\r\n        this._activeTiles = [];\r\n        this._tileLoadQueueHigh = []; // high priority tiles are preventing refinement\r\n        this._tileLoadQueueMedium = []; // medium priority tiles are being rendered\r\n        this._tileLoadQueueLow = []; // low priority tiles were refined past or are non-visible parts of quads.\r\n\r\n        this._tileReplacementQueue = new TileReplacementQueue();\r\n\r\n        this._loadQueueTimeSlice = 5.0;\r\n\r\n        this.maximumScreenSpaceError = options.maximumScreenSpaceError || 2;\r\n\r\n        this.tileCacheSize = options.tileCacheSize || 256;\r\n\r\n        this.maxDepth = 22;\r\n\r\n        this._lastTileLoadQueueLength = 0;\r\n\r\n        this.needUpdate = true;\r\n\r\n        this._debug = {\r\n            enableDebugOutput: true,\r\n\r\n            maxDepth: 0,\r\n            tilesVisited: 0,\r\n            tilesCulled: 0,\r\n            tilesRendered: 0,\r\n            tilesWaitingForChildren: 0,\r\n\r\n            lastMaxDepth: -1,\r\n            lastTilesVisited: -1,\r\n            lastTilesCulled: -1,\r\n            lastTilesRendered: -1,\r\n            lastTilesWaitingForChildren: -1,\r\n\r\n            suspendLodUpdate: false,\r\n        };\r\n\r\n        this._pool = new Pool({\r\n            instance: this.mode.instance,\r\n        });\r\n    }\r\n\r\n    suspendLodUpdate(value) {\r\n        this._debug.suspendLodUpdate = value;\r\n    }\r\n\r\n    update() {\r\n        // If not thing need to update, do noting\r\n        if (!this.needUpdate || this._debug.suspendLodUpdate) {\r\n            return;\r\n        }\r\n        this.needUpdate = false;\r\n\r\n        // Compute frustum of camera\r\n        this.camera.update();\r\n\r\n        clearTileLoadQueue(this);\r\n\r\n        this._tileReplacementQueue.markStartOfRenderFrame();\r\n\r\n        selectTilesForRendering(this);\r\n\r\n        renderTiles(this, this._activeTiles);\r\n\r\n        processTileLoadQueue(this);\r\n\r\n        updateTileLoadProgress(this);\r\n\r\n        this.camera.updatedLastFrame = false;\r\n    }\r\n}\r\n\r\nfunction clearTileLoadQueue(primitive: QuadTree) {\r\n    const debug = primitive._debug;\r\n    debug.maxDepth = 0;\r\n    debug.tilesVisited = 0;\r\n    debug.tilesCulled = 0;\r\n    debug.tilesRendered = 0;\r\n    debug.tilesWaitingForChildren = 0;\r\n\r\n    primitive._tileLoadQueueHigh.length = 0;\r\n    primitive._tileLoadQueueMedium.length = 0;\r\n    primitive._tileLoadQueueLow.length = 0;\r\n}\r\n\r\nfunction selectTilesForRendering(primitive: QuadTree) {\r\n    const debug = primitive._debug;\r\n\r\n    // Clear the render list.\r\n    const tilesToRender = primitive._activeTiles;\r\n    tilesToRender.length = 0;\r\n\r\n    // We can't render anything before the level zero tiles exist.\r\n    // var tileProvider = primitive._tileProvider;\r\n\r\n    let tile: Tile;\r\n    const rootTiles = primitive._rootTile;\r\n\r\n    // Our goal with load ordering is to first load all of the tiles we need to\r\n    // render the current scene at full detail.  Loading any other tiles is just\r\n    // a form of prefetching, and we need not do it at all (other concerns aside).  This\r\n    // simple and obvious statement gets more complicated when we realize that, because\r\n    // we don't have bounding volumes for the entire terrain tile pyramid, we don't\r\n    // precisely know which tiles we need to render the scene at full detail, until we do\r\n    // some loading.\r\n    //\r\n    // So our load priority is (from high to low):\r\n    // 1. Tiles that we _would_ render, except that they're not sufficiently loaded yet.\r\n    //    Ideally this would only include tiles that we've already determined to be visible,\r\n    //    but since we don't have reliable visibility information until a tile is loaded,\r\n    //    and because we (currently) must have all children in a quad renderable before we\r\n    //    can refine, this pretty much means tiles we'd like to refine to, regardless of\r\n    //    visibility. (high)\r\n    // 2. Tiles that we're rendering. (medium)\r\n    // 3. All other tiles. (low)\r\n    //\r\n    // Within each priority group, tiles should be loaded in approximate near-to-far order,\r\n    // but currently they're just loaded in our traversal order which makes no guarantees\r\n    // about depth ordering.\r\n\r\n    // Traverse in depth-first, near-to-far order.\r\n    for (let i = 0, len = rootTiles.length; i < len; ++i) {\r\n        tile = rootTiles[i];\r\n        primitive._tileReplacementQueue.markTileRendered(tile);\r\n        if (!tile.renderable) {\r\n            if (tile.needsLoading) {\r\n                primitive._tileLoadQueueHigh.push(tile);\r\n            }\r\n            ++debug.tilesWaitingForChildren;\r\n        } else if (computeTileVisibility(primitive, tile)) {\r\n            visitTile(primitive, tile);\r\n        } else {\r\n            if (tile.needsLoading) {\r\n                primitive._tileLoadQueueLow.push(tile);\r\n            }\r\n            ++debug.tilesCulled;\r\n        }\r\n    }\r\n}\r\n\r\nfunction visitTile(primitive: QuadTree, tile: Tile) {\r\n    const debug = primitive._debug;\r\n\r\n    ++debug.tilesVisited;\r\n\r\n    primitive._tileReplacementQueue.markTileRendered(tile);\r\n\r\n    if (tile.z > debug.maxDepth) {\r\n        debug.maxDepth = tile.z;\r\n    }\r\n\r\n    if (primitive.mode.screenSpaceError(primitive, tile) < primitive.maximumScreenSpaceError) {\r\n        // This tile meets SSE requirements, so render it.\r\n        if (tile.needsLoading) {\r\n            // Rendered tile meeting SSE loads with medium priority.\r\n            primitive._tileLoadQueueMedium.push(tile);\r\n        }\r\n        addTileToRenderList(primitive, tile);\r\n        return;\r\n    }\r\n\r\n    const allAreRenderable = tile.children[0].renderable && tile.children[1].renderable\r\n        && tile.children[2].renderable && tile.children[3].renderable;\r\n    const allAreUpsampled = tile.children[0].upsampledFromParent && tile.children[1].upsampledFromParent &&\r\n        tile.children[2].upsampledFromParent && tile.children[3].upsampledFromParent;\r\n\r\n    if (allAreRenderable) {\r\n        if (allAreUpsampled) {\r\n            // No point in rendering the children because they're all upsampled.  Render this tile instead.\r\n            addTileToRenderList(primitive, tile);\r\n\r\n            // Load the children even though we're (currently) not going to render them.\r\n            // A tile that is \"upsampled only\" right now might change its tune once it does more loading.\r\n            // A tile that is upsampled now and forever should also be done loading, so no harm done.\r\n            queueChildLoadNearToFar(primitive, primitive.camera.target, tile.children);\r\n\r\n            if (tile.needsLoading) {\r\n                // Rendered tile that's not waiting on children loads with medium priority.\r\n                primitive._tileLoadQueueMedium.push(tile);\r\n            }\r\n        } else {\r\n            // SSE is not good enough and children are loaded, so refine.\r\n            // No need to add the children to the load queue because\r\n            // they'll be added (if necessary) when they're visited.\r\n            visitVisibleChildrenNearToFar(primitive, tile.children);\r\n\r\n            if (tile.needsLoading) {\r\n                // Tile is not rendered, so load it with low priority.\r\n                primitive._tileLoadQueueLow.push(tile);\r\n            }\r\n        }\r\n    } else {\r\n        // We'd like to refine but can't because not all of our children are\r\n        // renderable.  Load the refinement blockers with high priority and\r\n        // render this tile in the meantime.\r\n        queueChildLoadNearToFar(primitive, primitive.camera.target, tile.children);\r\n        addTileToRenderList(primitive, tile);\r\n\r\n        if (tile.needsLoading) {\r\n            // We will refine this tile when it's possible, so load this tile only with low priority.\r\n            primitive._tileLoadQueueLow.push(tile);\r\n        }\r\n    }\r\n}\r\n\r\nfunction queueChildLoadNearToFar(primitive: QuadTree, cameraPosition: Cartesian, children: Tile[]) {\r\n    if (cameraPosition.x < children[0].bbox.xMax) {\r\n        if (cameraPosition.z < children[0].bbox.zMax) {\r\n            // Camera in northwest quadrant\r\n            queueChildTileLoad(primitive, children[0]);\r\n            queueChildTileLoad(primitive, children[2]);\r\n            queueChildTileLoad(primitive, children[1]);\r\n            queueChildTileLoad(primitive, children[3]);\r\n        } else {\r\n            // Camera in southwest quadrant\r\n            queueChildTileLoad(primitive, children[2]);\r\n            queueChildTileLoad(primitive, children[0]);\r\n            queueChildTileLoad(primitive, children[3]);\r\n            queueChildTileLoad(primitive, children[1]);\r\n        }\r\n    } else if (cameraPosition.z < children[0].bbox.zMax) {\r\n        // Camera northeast quadrant\r\n        queueChildTileLoad(primitive, children[1]);\r\n        queueChildTileLoad(primitive, children[3]);\r\n        queueChildTileLoad(primitive, children[0]);\r\n        queueChildTileLoad(primitive, children[2]);\r\n    } else {\r\n        // Camera in northeast quadrant\r\n        queueChildTileLoad(primitive, children[3]);\r\n        queueChildTileLoad(primitive, children[1]);\r\n        queueChildTileLoad(primitive, children[2]);\r\n        queueChildTileLoad(primitive, children[0]);\r\n    }\r\n}\r\n\r\nfunction queueChildTileLoad(primitive: QuadTree, childTile: Tile) {\r\n    // Tile is deeper than max stop\r\n    if (childTile.z > primitive.maxDepth) {\r\n        return;\r\n    }\r\n\r\n    primitive._tileReplacementQueue.markTileRendered(childTile);\r\n    if (childTile.needsLoading) {\r\n        if (childTile.renderable) {\r\n            primitive._tileLoadQueueLow.push(childTile);\r\n        } else {\r\n            // A tile blocking refine loads with high priority\r\n            primitive._tileLoadQueueHigh.push(childTile);\r\n        }\r\n    }\r\n}\r\n\r\nfunction visitVisibleChildrenNearToFar(primitive: QuadTree, children: Tile[]) {\r\n    const distances = children.map((child) => {\r\n        return { tile: child, distance: child.bbox.distanceFromPoint(primitive.camera.target) };\r\n    });\r\n    distances.sort((a, b) => {\r\n        return a.distance - b.distance;\r\n    });\r\n\r\n    distances.forEach(({ tile }) => visitIfVisible(primitive, tile));\r\n}\r\n\r\nfunction computeTileVisibility(primitive: QuadTree, tile: Tile) {\r\n    if (tile.z <= 10) {\r\n        const camera = primitive.cameraController.camera;\r\n\r\n        const matrix = new THREE.Matrix4().multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n        const frustum = new THREE.Frustum().setFromMatrix(matrix);\r\n\r\n        // TODO: using AABB to Culling\r\n        return frustum.intersectsObject(tile.mesh);\r\n    }\r\n\r\n    let i;\r\n    const corner = tile.bbox.corner;\r\n    for (i = 0; i < 4; i++) {\r\n        if (GeometricHelper.pointInsidePolygon(corner, primitive.camera.culledGroundPlane[i])) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    for (i = 0; i < 4; i++) {\r\n        if (GeometricHelper.pointInsidePolygon(primitive.camera.culledGroundPlane, corner[i])) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    for (i = 0; i < 4; i++) {\r\n        for (let j = 0; j < 4; j++) {\r\n            const l1 = [corner[i], corner[(i + 1) % 4]];\r\n            const l2 = [primitive.camera.culledGroundPlane[j], primitive.camera.culledGroundPlane[(j + 1) % 4]];\r\n            if (GeometricHelper.lineIntersects(l1, l2)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction visitIfVisible(primitive, tile) {\r\n    if (computeTileVisibility(primitive, tile)) {\r\n        visitTile(primitive, tile);\r\n    } else {\r\n        ++primitive._debug.tilesCulled;\r\n        primitive._tileReplacementQueue.markTileRendered(tile);\r\n\r\n        // We've decided this tile is not visible, but if it's not fully loaded yet, we've made\r\n        // this determination based on possibly-incorrect information.  We need to load this\r\n        // culled tile with low priority just in case it turns out to be visible after all.\r\n        if (tile.needsLoading) {\r\n            primitive._tileLoadQueueLow.push(tile);\r\n        }\r\n    }\r\n}\r\n\r\nfunction addTileToRenderList(primitive, tile) {\r\n    primitive._activeTiles.push(tile);\r\n\r\n    ++primitive._debug.tilesRendered;\r\n}\r\n\r\nfunction renderTiles(primitive: QuadTree, tiles: Tile[]) {\r\n    if (tiles.length === 0) {\r\n        return;\r\n    }\r\n\r\n    const pool = primitive._pool;\r\n\r\n    while (tiles.length > pool.length) {\r\n        pool.duplicate();\r\n    }\r\n\r\n    primitive.tiles.children.length = 0;\r\n\r\n    const target = primitive.camera.target;\r\n\r\n    tiles.forEach((tile) => {\r\n        // Recalculate tile position\r\n        const center = tile.bbox.center;\r\n        const mesh = tile.mesh;\r\n\r\n        mesh.position.set(center.x - target.x, center.y - target.y, center.z - target.z);\r\n        tile.applyDataToMesh(mesh);\r\n\r\n        primitive.tiles.add(mesh);\r\n    });\r\n}\r\n\r\nfunction processTileLoadQueue(primitive: QuadTree) {\r\n    const tileLoadQueueHigh = primitive._tileLoadQueueHigh;\r\n    const tileLoadQueueMedium = primitive._tileLoadQueueMedium;\r\n    const tileLoadQueueLow = primitive._tileLoadQueueLow;\r\n\r\n    if (tileLoadQueueHigh.length === 0 && tileLoadQueueMedium.length === 0 && tileLoadQueueLow.length === 0) {\r\n        return;\r\n    }\r\n\r\n    // Remove any tiles that were not used this frame beyond the number\r\n    // we're allowed to keep.\r\n    primitive._tileReplacementQueue.trimTiles(primitive.tileCacheSize);\r\n\r\n    const endTime = Date.now() + primitive._loadQueueTimeSlice;\r\n\r\n    processSinglePriorityLoadQueue(primitive, endTime, tileLoadQueueHigh);\r\n    processSinglePriorityLoadQueue(primitive, endTime, tileLoadQueueMedium);\r\n    processSinglePriorityLoadQueue(primitive, endTime, tileLoadQueueLow);\r\n}\r\n\r\nfunction processSinglePriorityLoadQueue(primitive: QuadTree, endTime: number, loadQueue: Tile[]) {\r\n    for (let i = 0, len = loadQueue.length; i < len && Date.now() < endTime; ++i) {\r\n        const tile = loadQueue[i];\r\n        primitive._tileReplacementQueue.markTileRendered(tile);\r\n\r\n        primitive.mode.providers.forEach((provider) => provider.loadTile(tile));\r\n    }\r\n}\r\n\r\nfunction updateTileLoadProgress(primitive) {\r\n    const currentLoadQueueLength = primitive._tileLoadQueueHigh.length +\r\n        primitive._tileLoadQueueMedium.length +\r\n        primitive._tileLoadQueueLow.length;\r\n\r\n    if (currentLoadQueueLength !== primitive._lastTileLoadQueueLength) {\r\n        primitive._lastTileLoadQueueLength = currentLoadQueueLength;\r\n    }\r\n\r\n    const debug = primitive._debug;\r\n    if (debug.enableDebugOutput && !debug.suspendLodUpdate) {\r\n        if (debug.tilesVisited !== debug.lastTilesVisited ||\r\n            debug.tilesRendered !== debug.lastTilesRendered ||\r\n            debug.tilesCulled !== debug.lastTilesCulled ||\r\n            debug.maxDepth !== debug.lastMaxDepth ||\r\n            debug.tilesWaitingForChildren !== debug.lastTilesWaitingForChildren) {\r\n            console.info('Visited ' + debug.tilesVisited + ', Rendered: ' + debug.tilesRendered +\r\n                ', Culled: ' + debug.tilesCulled + ', Max Depth: ' + debug.maxDepth +\r\n                ', Waiting for children: ' + debug.tilesWaitingForChildren);\r\n\r\n            debug.lastTilesVisited = debug.tilesVisited;\r\n            debug.lastTilesRendered = debug.tilesRendered;\r\n            debug.lastTilesCulled = debug.tilesCulled;\r\n            debug.lastMaxDepth = debug.maxDepth;\r\n            debug.lastTilesWaitingForChildren = debug.tilesWaitingForChildren;\r\n        }\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Renderer } from 'three';\r\nimport { Mission } from '../Object/Mission';\r\nimport { Polygon } from '../Object/Polygon';\r\nimport { Polyline } from '../Object/Polyline';\r\nimport { RenderingObject } from '../Object/RenderingObject';\r\nimport { Skybox } from '../Object/Skybox';\r\nimport { Vehicle } from '../Object/Vehicle';\r\nimport { Camera } from '../Renderer/Camera';\r\nimport { OrbitControls } from '../Renderer/OrbitControls';\r\nimport { SceneMode } from '../SceneMode/SceneMode';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { MapSettings } from './MapSettings';\r\nimport { QuadTree } from './QuadTree';\r\n\r\nexport interface IOptions {\r\n    mode: SceneMode;\r\n    canvas: QtCanvas;\r\n    eventSource?: EventSource;\r\n    renderer?: Renderer;\r\n    context2d?: Context2D;\r\n}\r\n\r\nexport class Map3D {\r\n    static State = {\r\n        GROUND: 0,\r\n        TAKEOFF: 1,\r\n    };\r\n\r\n    quadTree: QuadTree;\r\n\r\n    camera: Camera;\r\n    cameraController: OrbitControls;\r\n    scene: THREE.Scene;\r\n    canvas: QtCanvas;\r\n    context2d: Context2D;\r\n\r\n    _renderer: Renderer;\r\n    _subscribeObjects: RenderingObject[];\r\n\r\n    missions: Mission[];\r\n    _currentMission: Mission;\r\n\r\n    state: number;\r\n\r\n    vehicle: Vehicle;\r\n\r\n    constructor(options) {\r\n        this._subscribeObjects = [];\r\n        this._renderer = options.renderer;\r\n\r\n        this.scene = new THREE.Scene();\r\n\r\n        this.camera = new Camera({ canvas: options.canvas, map: this });\r\n        this.camera.setPosition({ z: MapSettings.cameraDistance });\r\n\r\n        // TODO: target distance min 0.03527380584401122\r\n        this.cameraController = new OrbitControls({\r\n            map: this,\r\n            eventSource: options.eventSource,\r\n            canvas: options.canvas,\r\n        });\r\n\r\n        this.canvas = options.canvas;\r\n\r\n        this.context2d = options.context2d;\r\n\r\n        this.quadTree = new QuadTree({\r\n            map: this,\r\n            mode: options.mode,\r\n        });\r\n\r\n        this.missions = [];\r\n        this.newMission();\r\n\r\n        // Add skybox\r\n        const skybox = new Skybox();\r\n        this.scene.add(skybox);\r\n\r\n        /**\r\n         * @type {Vehicle}\r\n         */\r\n        this.vehicle = new Vehicle({ map: this });\r\n\r\n        this.state = Map3D.State.GROUND;\r\n    }\r\n\r\n    get currentMission() {\r\n        if (!this._currentMission) {\r\n            this._currentMission = new Polygon({ map: this });\r\n            this.missions.push(this._currentMission);\r\n        }\r\n        return this._currentMission;\r\n    }\r\n\r\n    get vehiclePosition() {\r\n        return this.vehicle.position;\r\n    }\r\n    set vehiclePosition(cartographic: Cartographic) {\r\n        this.vehicle.position = cartographic;\r\n    }\r\n\r\n    newMission(type?: string) {\r\n        this._currentMission = (type === 'Polyline') ? new Polyline({ map: this }) : new Polygon({ map: this });\r\n        this.missions.push(this._currentMission);\r\n        return this._currentMission;\r\n    }\r\n\r\n    update() {\r\n        // Quad Tree update\r\n        this.quadTree.update();\r\n\r\n        // Mission update\r\n        const scale = this.cameraController.constraint.targetDistance *\r\n            sphericalMercator.mPerPixel() * 4.0 / this.canvas.height;\r\n\r\n        this.vehicle.setScale(scale);\r\n        this.missions.forEach((mission) => {\r\n            mission.pins.forEach((pin) => {\r\n                pin.setScale(scale);\r\n            });\r\n        });\r\n    }\r\n\r\n    generateGrid(type?: string) {\r\n        (this._currentMission as Polygon).generateGrid(type || 'opt', 4);\r\n    }\r\n\r\n    guide() {\r\n        this.cameraController.guide(this.vehicle);\r\n    }\r\n\r\n    setView(position: Cartographic, zoom: number) {\r\n        this.cameraController.setView(position, zoom);\r\n    }\r\n\r\n    resizeView(canvas: QtCanvas) {\r\n        this.camera.aspect = canvas.width / canvas.height;\r\n        this.camera.updateProjectionMatrix();\r\n\r\n        if ((this._renderer as any).setPixelRatio) {\r\n            (this._renderer as any).setPixelRatio(canvas.devicePixelRatio);\r\n        }\r\n        this._renderer.setSize(canvas.width, canvas.height);\r\n    }\r\n\r\n    addSubscribeObject(object: RenderingObject) {\r\n        this._subscribeObjects.push(object);\r\n    }\r\n\r\n    removeSubscribeObject(object: RenderingObject) {\r\n        const index = this._subscribeObjects.indexOf(object);\r\n\r\n        if (index !== -1) {\r\n            this._subscribeObjects.splice(index, 1);\r\n        }\r\n\r\n        return this;\r\n    }\r\n}\r\n","import { Ellipsoid } from '../Math/Ellipsoid';\r\n\r\nexport interface TilingSchemeOptions {\r\n    numberOfLevelZeroTilesX: number;\r\n    numberOfLevelZeroTilesY: number;\r\n}\r\n\r\nexport class TilingScheme {\r\n    private _ellipsoid: Ellipsoid;\r\n    private _numberOfLevelZeroTilesX: number;\r\n    private _numberOfLevelZeroTilesY: number;\r\n    constructor(options: TilingSchemeOptions) {\r\n        this._ellipsoid = new Ellipsoid(6378137.0, 6378137.0, 6356752.3142451793);\r\n        this._numberOfLevelZeroTilesX = options.numberOfLevelZeroTilesX;\r\n        this._numberOfLevelZeroTilesY = options.numberOfLevelZeroTilesY;\r\n    }\r\n\r\n    getNumberOfXTilesAtLevel(level) {\r\n        return this._numberOfLevelZeroTilesX << level;\r\n    }\r\n\r\n    getNumberOfYTilesAtLevel(level) {\r\n        return this._numberOfLevelZeroTilesY << level;\r\n    }\r\n\r\n    get ellipsoid() { return this._ellipsoid; }\r\n}\r\n","import { Tile } from '../SceneMode/Tile';\r\nimport { DataSourceLayer, DataSourceLayerConstructor } from './DataSourceLayer';\r\n\r\nexport interface Status {\r\n    [key: string]: number;\r\n}\r\n\r\nexport class DataSource {\r\n    static State = {\r\n        Idle: 1,\r\n        Loading: 2,\r\n        Loaded: 3,\r\n        Failed: 4,\r\n    };\r\n\r\n    _layers: DataSourceLayer[];\r\n    _tile: Tile;\r\n    status: Status;\r\n\r\n    constructor(options) {\r\n        if (!options) {\r\n            throw new Error('DataSource must provided arguments.');\r\n        }\r\n        if (!options.layers) {\r\n            throw new Error('DataSource must provided options.layers');\r\n        }\r\n        if (!options.tile) {\r\n            throw new Error('DataSource must provided options.tile');\r\n        }\r\n        /**\r\n         * @type {DataSourceLayer[]}\r\n         */\r\n        this._layers = options.layers;\r\n        /**\r\n         * @type {Tile}\r\n         */\r\n        this._tile = options.tile;\r\n        /**\r\n         * @type {Object}\r\n         */\r\n        this.status = {};\r\n        Object.keys(this._layers).forEach((key) => {\r\n            this.status[key] = DataSource.State.Idle;\r\n        });\r\n    }\r\n    /**\r\n     * @param {string} layer - Layer name\r\n     */\r\n    loading(layer) {\r\n        if (typeof this._layers[layer] === 'undefined') {\r\n            throw new Error('Unknowed layer was trigger datasource.');\r\n        }\r\n        this._layers[layer].processLoading(this._tile);\r\n    }\r\n    loaded(layer, data) {\r\n        if (!this._tile) {\r\n            // TODO: Dispose;\r\n            return;\r\n        }\r\n        if (this._tile.disposed) {\r\n            return;\r\n        } \r\n        if (typeof this._layers[layer] === 'undefined') {\r\n            throw new Error('Unknowed layer was trigger datasource.');\r\n        }\r\n        this._layers[layer].processData(this._tile, data);\r\n        if (this.done) {\r\n            this._tile.quadTree.needUpdate = true;\r\n        }\r\n    }\r\n    failed(layer, error) {\r\n        if (typeof this.status[layer] === 'undefined') {\r\n            throw new Error('Unknowed layer was trigger datasource.');\r\n        }\r\n        this._layers[layer].processError(this._tile, error);\r\n    }\r\n    isLoading(layer) {\r\n        return this.status[layer] >= DataSource.State.Loading;\r\n    }\r\n    dispose() {\r\n        Object.keys(this._layers).forEach((key) => {\r\n            this.status[key] = DataSource.State.Idle;\r\n        });\r\n        this._tile = undefined;\r\n    }\r\n    static toLayers(layers: DataSourceLayerConstructor[]) {\r\n        return layers.reduce((prev: { [key: string]: DataSourceLayer }, Instance) => {\r\n            prev[Instance.layerName] = new Instance();\r\n            return prev;\r\n        }, {});\r\n    }\r\n\r\n    get done() {\r\n        return Object.keys(this._layers).reduce((prev, key) =>\r\n            prev && this.status[key] === DataSource.State.Loaded, true);\r\n    }\r\n\r\n    get needsLoading() {\r\n        return Object.keys(this._layers).reduce((prev, key) =>\r\n            prev || this.status[key] < DataSource.State.Loaded, false);\r\n    }\r\n}\r\n","import { Tile } from '../SceneMode/Tile';\r\n\r\nexport interface DataSourceLayerConstructor {\r\n    new (): DataSourceLayer;\r\n\r\n    layerName;\r\n}\r\n\r\nexport abstract class DataSourceLayer {\r\n    static layerName = 'none';\r\n\r\n    abstract processLoading(tile: Tile);\r\n    abstract processData(tile: Tile, data: any);\r\n    abstract processError(tile: Tile, error: any);\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile2D } from '../SceneMode/Tile2D';\r\nimport { DataSource } from './DataSource';\r\nimport { DataSourceLayer } from './DataSourceLayer';\r\n\r\nexport class ImageDataLayer extends DataSourceLayer {\r\n    static layerName = 'texture';\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    processLoading(tile: Tile2D) {\r\n        tile.data.status[ImageDataLayer.layerName] = DataSource.State.Loading;\r\n    }\r\n\r\n    processData(tile: Tile2D, data: THREE.Texture) {\r\n        if (tile.material) {\r\n            throw new Error('Material\\'s already set up.');\r\n        }\r\n        tile.material = new THREE.MeshBasicMaterial({\r\n            map: data,\r\n        });\r\n\r\n        tile.data.status[ImageDataLayer.layerName] = DataSource.State.Loaded;\r\n    }\r\n\r\n    processError(tile: Tile2D, error: Error) {\r\n        tile.data.status[ImageDataLayer.layerName] = DataSource.State.Idle;\r\n    }\r\n}\r\n","import { Tile } from '../SceneMode/Tile';\r\n\r\nexport interface ProviderOptions {\r\n    maxLoad?: number;\r\n}\r\n\r\nexport abstract class Provider {\r\n    _maxLoad: number;\r\n    _loading: number;\r\n    _needUpdate: boolean;\r\n\r\n    constructor(options?: ProviderOptions) {\r\n        options = options || {};\r\n        this._maxLoad = options.maxLoad || 50;\r\n        this._loading = 0;\r\n    }\r\n\r\n    protected abstract url(x: number, y: number, z: number);\r\n\r\n    public abstract loadTile(tile: Tile);\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile } from '../SceneMode/Tile';\r\nimport { ImageDataLayer } from './ImageDataLayer';\r\nimport { Provider, ProviderOptions } from './Provider';\r\n\r\nexport interface ImageryProviderOptions extends ProviderOptions {}\r\n\r\nexport class ImageryProvider extends Provider {\r\n    constructor(options?: ImageryProviderOptions) {\r\n        super(options);\r\n    }\r\n\r\n    protected url(x: number, y: number, z: number) {\r\n        const serverIndex = 2 * (x % 2) + y % 2;\r\n        const server = ['a', 'b', 'c', 'd'][serverIndex];\r\n        return 'https://' + server + '.tiles.mapbox.com/v4/mapbox.satellite/' + z + '/' + x + '/' + y +\r\n            '@2x.png?access_token=pk.eyJ1IjoibWF0dCIsImEiOiJTUHZkajU0In0.oB-OGTMFtpkga8vC48HjIg';\r\n    }\r\n\r\n    loadTile(tile: Tile) {\r\n        if (this._loading >= this._maxLoad || tile.data.isLoading(ImageDataLayer.layerName)) {\r\n            return;\r\n        }\r\n\r\n        const scope = this;\r\n        const onComplete = (resp) => {\r\n            scope._needUpdate = true;\r\n            scope._loading--;\r\n\r\n            if (tile.disposed) {\r\n                return;\r\n            }\r\n            tile.data.loaded(ImageDataLayer.layerName, texture);\r\n        };\r\n\r\n        const onError = (err) => {\r\n            if (err) {\r\n                if (tile.disposed) {\r\n                    return;\r\n                }\r\n                scope._loading--;\r\n\r\n                console.error('Error loading texture' + tile.stringify);\r\n                tile.data.failed(ImageDataLayer.layerName, err);\r\n            }\r\n        };\r\n\r\n        this._loading++;\r\n        const texture = new THREE.TextureLoader()\r\n            .load(this.url(tile.x, tile.y, tile.z), onComplete, undefined, onError);\r\n        tile.data.loading(ImageDataLayer.layerName);\r\n    }\r\n}\r\n","import { Camera } from '../Renderer/Camera';\r\nimport { Cartesian } from './Cartesian';\r\n\r\nexport interface AABBOptions {\r\n    topLeftCorner: Cartesian;\r\n    bottomRightCorner: Cartesian;\r\n}\r\n\r\nconst UNIT_Y = new Cartesian({ x: 0.0, y: 1.0, z: 0.0 });\r\nconst t = [[0, 0], [0, 1], [1, 1], [1, 0]];\r\nconst c = new Cartesian();\r\nconst cameraCartesianPosition = new Cartesian();\r\n\r\nexport class AABB {\r\n    xMin: number;\r\n    yMin: number;\r\n    zMin: number;\r\n    xMax: number;\r\n    yMax: number;\r\n    zMax: number;\r\n    westNormal: Cartesian;\r\n    eastNormal: Cartesian;\r\n    northNormal: Cartesian;\r\n    southNormal: Cartesian;\r\n    northwestCornnerCartesian: Cartesian;\r\n    southeastCornnerCartesian: Cartesian;\r\n    _corner: Cartesian[];\r\n\r\n    constructor(options: AABBOptions) {\r\n        this.xMin = options.topLeftCorner.x || 0;\r\n        this.yMin = options.topLeftCorner.y || 0;\r\n        this.zMin = options.topLeftCorner.z || 0;\r\n        this.xMax = options.bottomRightCorner.x || 0;\r\n        this.yMax = options.bottomRightCorner.y || 0;\r\n        this.zMax = options.bottomRightCorner.z || 0;\r\n\r\n        // Compute the normal of the plane on the western edge of the tile.\r\n        const midPoint = new Cartesian();\r\n        midPoint.x = (this.xMax + this.xMin) / 2;\r\n        midPoint.z = (this.zMax + this.zMin) / 2;\r\n        const temp2 = new Cartesian();\r\n        const westernMidpointCartesian = new Cartesian();\r\n        westernMidpointCartesian.x = (this.xMax + this.xMin) / 2;\r\n        westernMidpointCartesian.z = this.zMin;\r\n        this.westNormal = new Cartesian();\r\n        this.westNormal.crossVectors(temp2.subVectors(midPoint, westernMidpointCartesian), UNIT_Y);\r\n        this.westNormal.normalize();\r\n        const easternMidpointCartesian = new Cartesian();\r\n        easternMidpointCartesian.x = (this.xMax + this.xMin) / 2;\r\n        easternMidpointCartesian.z = this.zMax;\r\n        this.eastNormal = new Cartesian();\r\n        this.eastNormal.crossVectors(temp2.subVectors(midPoint, easternMidpointCartesian), UNIT_Y);\r\n        this.eastNormal.normalize();\r\n        const northMidpointCartesian = new Cartesian();\r\n        northMidpointCartesian.x = this.xMax;\r\n        northMidpointCartesian.z = (this.zMax + this.zMin) / 2;\r\n        this.northNormal = new Cartesian();\r\n        this.northNormal.crossVectors(temp2.subVectors(midPoint, northMidpointCartesian), UNIT_Y);\r\n        this.northNormal.normalize();\r\n        const southMidpointCartesian = new Cartesian();\r\n        southMidpointCartesian.x = this.xMin;\r\n        southMidpointCartesian.z = (this.zMax + this.zMin) / 2;\r\n        this.southNormal = new Cartesian();\r\n        this.southNormal.crossVectors(temp2.subVectors(midPoint, southMidpointCartesian), UNIT_Y);\r\n        this.southNormal.normalize();\r\n        this.northwestCornnerCartesian = new Cartesian({ x: this.xMin, y: 0, z: this.zMin });\r\n        this.southeastCornnerCartesian = new Cartesian({ x: this.xMax, y: 0, z: this.zMax });\r\n        this._corner = new Array(4);\r\n        for (let i = 0; i < 4; ++i) {\r\n            // TODO: y\r\n            this._corner[i] = new Cartesian({\r\n                x: t[i][0] ? this.xMin : this.xMax,\r\n                y: 0,\r\n                z: t[i][1] ? this.zMin : this.zMax,\r\n            });\r\n        }\r\n    }\r\n    intersects(x, y, z) {\r\n        if (x instanceof AABB) {\r\n            const other = x;\r\n            return this.xMin < other.xMax && other.xMin < this.xMax &&\r\n                this.yMin < other.yMax && other.yMin < this.yMax &&\r\n                this.zMin < other.zMax && other.zMin < this.zMax;\r\n        }\r\n        return this.xMin <= x && this.xMax >= x &&\r\n            this.yMin <= y && this.yMax >= y &&\r\n            this.zMin <= z && this.zMax >= z;\r\n    }\r\n    onRect(x, z) {\r\n        return this.xMin <= x && this.xMax >= x &&\r\n            this.zMin <= z && this.zMax >= z;\r\n    }\r\n    distanceToCamera(camera: Camera) {\r\n        cameraCartesianPosition.set(\r\n            camera.position.x + camera.target.x,\r\n            camera.position.y + camera.target.y,\r\n            camera.position.z + camera.target.z,\r\n        );\r\n        return this.distanceFromPoint(cameraCartesianPosition);\r\n    }\r\n    distanceFromPoint(cartesian) {\r\n        const temp = new Cartesian();\r\n        let result = 0.0;\r\n        if (!this.onRect(cartesian.x, cartesian.z)) {\r\n            const northwestCornnerCartesian = this.northwestCornnerCartesian;\r\n            const southeastCornnerCartesian = this.southeastCornnerCartesian;\r\n            const westNormal = this.westNormal;\r\n            const southNormal = this.southNormal;\r\n            const eastNormal = this.eastNormal;\r\n            const northNormal = this.northNormal;\r\n            const vectorFromNorthwestCorner = temp.subVectors(cartesian, northwestCornnerCartesian);\r\n            const distanceToWestPlane = vectorFromNorthwestCorner.dot(westNormal);\r\n            const distanceToNorthPlane = vectorFromNorthwestCorner.dot(northNormal);\r\n            const vectorFromSoutheastCorner = temp.subVectors(cartesian, southeastCornnerCartesian);\r\n            const distanceToEastPlane = vectorFromSoutheastCorner.dot(eastNormal);\r\n            const distanceToSouthPlane = vectorFromSoutheastCorner.dot(southNormal);\r\n            if (distanceToWestPlane > 0.0) {\r\n                result += distanceToWestPlane * distanceToWestPlane;\r\n            } else if (distanceToEastPlane > 0.0) {\r\n                result += distanceToEastPlane * distanceToEastPlane;\r\n            }\r\n            if (distanceToSouthPlane > 0.0) {\r\n                result += distanceToSouthPlane * distanceToSouthPlane;\r\n            } else if (distanceToNorthPlane > 0.0) {\r\n                result += distanceToNorthPlane * distanceToNorthPlane;\r\n            }\r\n        }\r\n        const height = cartesian.height;\r\n        const distanceFromTop = height;\r\n        if (distanceFromTop > 0.0) {\r\n            result += distanceFromTop * distanceFromTop;\r\n        }\r\n        return Math.sqrt(result);\r\n    }\r\n\r\n    get corner() {\r\n        return this._corner;\r\n    }\r\n\r\n    get center() {\r\n        c.set(\r\n            (this.xMin + this.xMax) / 2,\r\n            (this.yMin + this.yMax) / 2,\r\n            (this.zMin + this.zMax) / 2,\r\n        );\r\n        return c;\r\n    }\r\n    get width() {\r\n        return this.xMax - this.xMin;\r\n    }\r\n    get height() {\r\n        return this.zMax - this.zMin;\r\n    }\r\n}\r\n","import { QuadTree } from '../Core/QuadTree';\r\nimport { TilingScheme } from '../Core/TilingScheme';\r\nimport { Provider } from '../DataSource/Provider';\r\nimport { AABB } from '../Math/AABB';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { Tile, TileConstructor } from './Tile';\r\n\r\nexport interface SceneModeOptions {\r\n    instance: TileConstructor;\r\n}\r\n\r\nconst topLeftCorner = new Cartesian();\r\nconst bottomRightCorner = new Cartesian();\r\n\r\nexport abstract class SceneMode {\r\n    providers: Provider[];\r\n    protected _tilingScheme: TilingScheme;\r\n    protected _instance: TileConstructor;\r\n\r\n    protected _topLeftCartographicCorner = QtPositioning.coordinate();\r\n    protected _bottomRightCartographicCorner = QtPositioning.coordinate();\r\n\r\n    constructor(options: SceneModeOptions) {\r\n        this._instance = options.instance;\r\n    }\r\n\r\n    getLevelMaximumGeometricError = function(level) {\r\n        return this._levelZeroMaximumGeometricError / (1 << level);\r\n    };\r\n\r\n    fog(distanceToCamera: number, density: number) {\r\n        const scalar = distanceToCamera * density;\r\n        return 1.0 - Math.exp(-(scalar * scalar));\r\n    }\r\n\r\n    screenSpaceError(quadTree: QuadTree, tile: Tile): number {\r\n        const camera = quadTree.camera;\r\n        const maxGeometricError = this.getLevelMaximumGeometricError(tile.z);\r\n\r\n        // Update distance of tile from camera\r\n        if (camera.updatedLastFrame || !tile.distance) {\r\n            tile.distance = tile.bbox.distanceToCamera(quadTree.camera);\r\n        }\r\n\r\n        const height = Math.max(quadTree.cameraController.canvas.height, quadTree.cameraController.canvas.width);\r\n        const sseDenominator = 2 * Math.tan(camera.fov * Math.PI / (2 * 180));\r\n\r\n        let error = (maxGeometricError * height) / (tile.distance * sseDenominator);\r\n\r\n        // TODO: Fof from Cesium\r\n        // if (frameState.fog.enabled) {\r\n        error = error - this.fog(tile.distance, 2.0e-4) * 2.0;\r\n        // }\r\n\r\n        return error;\r\n    }\r\n\r\n    getAABB(tile: Tile) {\r\n        // FIXME: FC\r\n        const width = 360.0 / this._tilingScheme.getNumberOfXTilesAtLevel(tile.z);\r\n        const height = 180.0 / this._tilingScheme.getNumberOfYTilesAtLevel(tile.z);\r\n        this._topLeftCartographicCorner.longitude = tile.x * width - 180.0;\r\n        this._topLeftCartographicCorner.altitude = 0;\r\n        this._topLeftCartographicCorner.latitude =  90.0 - tile.y * height;\r\n        sphericalMercator.FCartographicToCartesian(this._topLeftCartographicCorner, topLeftCorner);\r\n\r\n        this._bottomRightCartographicCorner.longitude = (tile.x + 1) * width - 180.0;\r\n        this._bottomRightCartographicCorner.altitude = 0;\r\n        this._bottomRightCartographicCorner.latitude = 90.0 - (tile.y + 1) * height;\r\n        sphericalMercator.FCartographicToCartesian(this._bottomRightCartographicCorner, bottomRightCorner);\r\n\r\n        return new AABB({ topLeftCorner, bottomRightCorner });\r\n    }\r\n\r\n    createRootTile(quadTree: QuadTree): Tile[] {\r\n        const numberOfLevelZeroTilesX = this._tilingScheme.getNumberOfXTilesAtLevel(0);\r\n        const numberOfLevelZeroTilesY = this._tilingScheme.getNumberOfYTilesAtLevel(0);\r\n\r\n        const result: Tile[] = new Array(numberOfLevelZeroTilesX * numberOfLevelZeroTilesY);\r\n\r\n        let index = 0;\r\n        for (let y = 0; y < numberOfLevelZeroTilesY; ++y) {\r\n            for (let x = 0; x < numberOfLevelZeroTilesX; ++x) {\r\n                result[index++] = new this._instance({\r\n                    x,\r\n                    y,\r\n                    z: 0,\r\n                    quadTree,\r\n                });\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected abstract get _levelZeroMaximumGeometricError();\r\n\r\n    get instance() { return this._instance; }\r\n}\r\n","import { MapSettings } from '../Core/MapSettings';\r\nimport { QuadTree } from '../Core/QuadTree';\r\nimport { DataSource } from '../DataSource/DataSource';\r\nimport { AABB } from '../Math/AABB';\r\n\r\nexport interface TileOptions {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    quadTree: QuadTree;\r\n    parent?: Tile;\r\n}\r\n\r\nexport interface TileConstructor {\r\n    new (options: TileOptions): Tile;\r\n    createMesh();\r\n}\r\n\r\nconst size = Array.apply(null, Array(32)).map((_, idx) => {\r\n    return MapSettings.basePlaneDimension / Math.pow(2, idx);\r\n});\r\n\r\nexport abstract class Tile {\r\n    static State = {\r\n        Start: 0,\r\n        Loading: 1,\r\n        Done: 2,\r\n        Failed: 3,\r\n        Removed: 4,\r\n    };\r\n\r\n    private _x: number;\r\n    private _y: number;\r\n    private _z: number;\r\n    private _quadTree: QuadTree;\r\n    private _parent: Tile;\r\n    private _state: number;\r\n    private _replacementPrevious: Tile;\r\n    private _replacementNext: Tile;\r\n    private _distance: number;\r\n    private _bbox: AABB;\r\n    upsampledFromParent: boolean;\r\n\r\n    private _children: Tile[];\r\n\r\n    private _mesh: THREE.Mesh;\r\n\r\n    constructor(options: TileOptions) {\r\n        this._x = options.x;\r\n        this._y = options.y;\r\n        this._z = options.z;\r\n        this._quadTree = options.quadTree;\r\n        // QuadTreeTile structure\r\n        this._parent = options.parent;\r\n        // State\r\n        this._state = Tile.State.Start;\r\n\r\n        this._replacementPrevious = undefined;\r\n        this._replacementNext = undefined;\r\n        this._distance = undefined;\r\n        this._bbox = undefined;\r\n        this.upsampledFromParent = false;\r\n\r\n        this._mesh = (this.constructor as TileConstructor).createMesh();\r\n    }\r\n\r\n    static createMesh() {\r\n        throw new Error('No createMesh in abstract Tile.');\r\n    }\r\n    abstract applyDataToMesh(mesh: THREE.Mesh): void;\r\n\r\n    dispose() {\r\n        // Remove link betweem parent\r\n        if (this._parent) {\r\n            for (let i = 0; i < 4; i++) {\r\n                if (this._parent._children[i] && this.stringify === this._parent._children[i].stringify) {\r\n                    this._parent._children[i] = undefined;\r\n                }\r\n            }\r\n        }\r\n        this._parent = undefined;\r\n        this._state = Tile.State.Removed;\r\n        this._bbox = undefined;\r\n        this.upsampledFromParent = false;\r\n        this.data.dispose();\r\n\r\n        if (this._children) {\r\n            for (let j = 0; j < 4; ++j) {\r\n                if (this._children[j]) {\r\n                    this._children[j].dispose();\r\n                    this._children[j] = undefined;\r\n                }\r\n            }\r\n        }\r\n        this._quadTree = undefined;\r\n    }\r\n\r\n    static size(z) {\r\n        return size[z];\r\n    }\r\n\r\n    get x() { return this._x; }\r\n    get y() { return this._y; }\r\n    get z() { return this._z; }\r\n    get parent() { return this._parent; }\r\n    get children() {\r\n        if (typeof this._children === 'undefined') {\r\n            this._children = new Array(4);\r\n        }\r\n\r\n        // FIXME: Type of instance\r\n        const Instance: TileConstructor = (this.constructor as any);\r\n\r\n        for (let i = 0; i < 4; ++i) {\r\n            if (typeof this._children[i] === 'undefined') {\r\n                this._children[i] = new Instance({\r\n                    x: this._x * 2 + i % 2,\r\n                    // Rounding float to integer ex. ~~2.5 = 2\r\n                    y: this._y * 2 + (~~(i / 2)) % 2,\r\n                    z: this._z + 1,\r\n                    parent: this,\r\n                    quadTree: this._quadTree,\r\n                });\r\n            }\r\n        }\r\n\r\n        return this._children;\r\n    }\r\n    get replacementPrevious() { return this._replacementPrevious; }\r\n    set replacementPrevious(tile) { this._replacementPrevious = tile; }\r\n    get replacementNext() { return this._replacementNext; }\r\n    set replacementNext(tile) { this._replacementNext = tile; }\r\n    get distance() { return this._distance; }\r\n    set distance(distance) { this._distance = distance; }\r\n    get bbox() {\r\n        if (!this._bbox) {\r\n            this._bbox = this._quadTree.mode.getAABB(this);\r\n        }\r\n\r\n        return this._bbox;\r\n    }\r\n    get quadTree() { return this._quadTree; }\r\n    /************************\r\n     * State handling\r\n     ***********************/\r\n    get state() { throw new Error('derpercate'); }\r\n    get needsLoading() { return this.data.needsLoading; }\r\n    get renderable() { return this.data.done; }\r\n    get eligibleForUnloading() { return true; }\r\n    get disposed() { return this._state === Tile.State.Removed; }\r\n    get stringify() { return this._x + '/' + this._y + '/' + this._z; }\r\n\r\n    abstract get data(): DataSource;\r\n\r\n    get mesh(): THREE.Mesh {\r\n        return this._mesh;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { DataSource } from '../DataSource/DataSource';\r\nimport { ImageDataLayer } from '../DataSource/ImageDataLayer';\r\nimport { Tile, TileOptions } from './Tile';\r\n\r\nexport interface Tile2DOptions extends TileOptions {}\r\n\r\nconst image = new Image();\r\nexport class Tile2D extends Tile {\r\n    public static dataLayers = DataSource.toLayers([ImageDataLayer]);\r\n\r\n    public data: DataSource;\r\n    private _material: THREE.Material;\r\n\r\n    constructor(options: Tile2DOptions) {\r\n        super(options);\r\n        this.data = new DataSource({\r\n            layers: Tile2D.dataLayers,\r\n            tile: this,\r\n        });\r\n    }\r\n\r\n    static createMesh() {\r\n        const material = null;\r\n\r\n        const geometry = new THREE.PlaneGeometry(1, 1);\r\n        geometry.rotateX(-Math.PI / 2);\r\n\r\n        return new THREE.Mesh(geometry, material);\r\n    }\r\n\r\n    applyDataToMesh(mesh: THREE.Mesh) {\r\n        const tileSize = Tile.size(this.z);\r\n\r\n        mesh.scale.set(tileSize, 1, tileSize);\r\n\r\n        if (!this._material) {\r\n            throw new Error(`Material not ready to use. ${this.stringify}`);\r\n        }\r\n        mesh.material = this._material;\r\n    }\r\n\r\n    dispose() {\r\n        super.dispose();\r\n        if (this._material) {\r\n            this._material.dispose();\r\n        }\r\n        this._material = undefined;\r\n    }\r\n\r\n    get material() { return this._material; }\r\n    set material(m: THREE.Material) { this._material = m; }\r\n}\r\n","import { QuadTree } from '../Core/QuadTree';\r\nimport { TilingScheme } from '../Core/TilingScheme';\r\nimport { ImageryProvider } from '../DataSource/ImageryProvider';\r\nimport { AABB } from '../Math/AABB';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Ellipsoid } from '../Math/Ellipsoid';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { SceneMode } from './SceneMode';\r\nimport { Tile } from './Tile';\r\nimport { Tile2D } from './Tile2D';\r\n\r\nfunction getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n    ellipsoid: Ellipsoid, tileImageWidth: number, numberOfTilesAtLevelZero: number) {\r\n    return ellipsoid.maximumRadius * 2 * Math.PI * 0.25 / (tileImageWidth * numberOfTilesAtLevelZero);\r\n}\r\n\r\nexport class Scene2D extends SceneMode {\r\n    protected _levelZeroMaximumGeometricError: number;\r\n    constructor() {\r\n        super({\r\n            instance: Tile2D,\r\n        });\r\n\r\n        this._tilingScheme = new TilingScheme({\r\n            numberOfLevelZeroTilesX: 1,\r\n            numberOfLevelZeroTilesY: 1,\r\n        });\r\n        this.providers = [\r\n            new ImageryProvider(),\r\n        ];\r\n\r\n        this._levelZeroMaximumGeometricError = getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n            this._tilingScheme.ellipsoid,\r\n            65,\r\n            this._tilingScheme.getNumberOfXTilesAtLevel(0),\r\n        );\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { TestTile } from '../SceneMode/TestTile';\r\nimport { DataSource } from './DataSource';\r\nimport { DataSourceLayer } from './DataSourceLayer';\r\n\r\nexport class TestDataLayer extends DataSourceLayer {\r\n    static layerName = 'test';\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    processLoading(tile: TestTile) {\r\n        tile.data.status[TestDataLayer.layerName] = DataSource.State.Loading;\r\n    }\r\n\r\n    processData(tile: TestTile) {\r\n        tile.data.status[TestDataLayer.layerName] = DataSource.State.Loaded;\r\n    }\r\n\r\n    processError(tile: TestTile, error: Error) {\r\n        throw new Error('Debug data can\\'t be error.');\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Provider, ProviderOptions } from './Provider';\r\nimport { TestDataLayer } from './TestDataLayer';\r\n\r\nexport interface ImageryProviderOptions extends ProviderOptions {}\r\n\r\nexport class TestProvider extends Provider {\r\n    constructor(options?: ImageryProviderOptions) {\r\n        super(options);\r\n    }\r\n\r\n    url() {\r\n        throw new Error('Can\\'t call url of TestProvide');\r\n    }\r\n\r\n    loadTile(tile) {\r\n        if (this._loading >= this._maxLoad) {\r\n            return;\r\n        }\r\n\r\n        if (tile.data.isLoading(TestDataLayer.layerName)) {\r\n            return;\r\n        }\r\n\r\n        const scope = this;\r\n        if (typeof Qt === 'object') {\r\n            timer.setTimeout(() => {\r\n                tile.data.loaded(TestDataLayer.layerName);\r\n                scope._loading--;\r\n            }, 10);\r\n        } else {\r\n            setTimeout(() => {\r\n                tile.data.loaded(TestDataLayer.layerName);\r\n                scope._loading--;\r\n            }, 10);\r\n        }\r\n\r\n        tile.data.loading(TestDataLayer.layerName);\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { DataSource } from '../DataSource/DataSource';\r\nimport { EPSG4326MapImageDataLayer } from '../DataSource/EPSG4326MapImageDataLayer';\r\nimport { TestDataLayer } from '../DataSource/TestDataLayer';\r\nimport { Tile, TileOptions } from '../SceneMode/Tile';\r\n\r\nexport interface Tile2DOptions extends TileOptions {}\r\n\r\nconst image = new Image();\r\nexport class TestTile extends Tile {\r\n    private static dataLayers = DataSource.toLayers([TestDataLayer]);\r\n    // TODO:\r\n    // private static dataLayers = DataSource.toLayers([EPSG4326MapImageDataLayer]);\r\n\r\n    private _material: THREE.Material;\r\n    public data: DataSource;\r\n\r\n    constructor(options: Tile2DOptions) {\r\n        super(options);\r\n        this.data = new DataSource({\r\n            layers: TestTile.dataLayers,\r\n            tile: this,\r\n        });\r\n    }\r\n\r\n    static createMesh() {\r\n        const material = new THREE.MeshBasicMaterial({\r\n            wireframe: true,\r\n            opacity: 0,\r\n        });\r\n\r\n        const geometry = new THREE.PlaneGeometry(1, 1);\r\n        geometry.rotateX(-Math.PI / 2);\r\n\r\n        return new THREE.Mesh(geometry, material);\r\n    }\r\n\r\n    applyDataToMesh(mesh: THREE.Mesh) {\r\n        const tileSize = Tile.size(this.z);\r\n\r\n        mesh.scale.set(tileSize / 2, 1, tileSize);\r\n        // const tileSize = Tile.size(this.z);\r\n\r\n        // mesh.material = this._material;\r\n\r\n        // mesh.scale.set(tileSize / 2, 10, tileSize);\r\n    }\r\n\r\n    dispose() {\r\n        super.dispose();\r\n    }\r\n\r\n    get material() { return this._material; }\r\n    set material(m) { this._material = m; }\r\n}\r\n","import { QuadTree } from '../Core/QuadTree';\r\nimport { TilingScheme } from '../Core/TilingScheme';\r\nimport { EPSG4326MapImageryProvider } from '../DataSource/EPSG4326MapImageryProvider';\r\nimport { TestProvider } from '../DataSource/TestProvider';\r\nimport { Ellipsoid } from '../Math/Ellipsoid';\r\nimport { SceneMode } from './SceneMode';\r\nimport { TestTile } from './TestTile';\r\n\r\nfunction getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n    ellipsoid: Ellipsoid, tileImageWidth: number, numberOfTilesAtLevelZero: number) {\r\n    return ellipsoid.maximumRadius * 2 * Math.PI * 0.25 / (tileImageWidth * numberOfTilesAtLevelZero);\r\n}\r\n\r\nexport class TestScene extends SceneMode {\r\n    _levelZeroMaximumGeometricError: number;\r\n    constructor() {\r\n        super({\r\n            instance: TestTile,\r\n        });\r\n\r\n        this._tilingScheme = new TilingScheme({\r\n            numberOfLevelZeroTilesX: 2,\r\n            numberOfLevelZeroTilesY: 1,\r\n        });\r\n        this.providers = [\r\n            // new EPSG4326MapImageryProvider(),\r\n            new TestProvider(),\r\n        ];\r\n\r\n        this._levelZeroMaximumGeometricError = getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n            this._tilingScheme.ellipsoid,\r\n            65,\r\n            this._tilingScheme.getNumberOfXTilesAtLevel(0),\r\n        );\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile } from '../SceneMode/Tile';\r\nimport { ImageryProvider } from './ImageryProvider';\r\nimport { Provider, ProviderOptions } from './Provider';\r\n\r\nexport interface BingMapImageryProviderOptions extends ProviderOptions {\r\n    key?: string;\r\n}\r\n\r\nexport class BingMapImageryProvider extends ImageryProvider {\r\n    private _ready: boolean = false;\r\n\r\n    private _baseUrl: string;\r\n    private _subdomains: string[];\r\n    private _zoomMax: number;\r\n    private _zoomMin: number;\r\n\r\n    constructor(options?: BingMapImageryProviderOptions) {\r\n        super(options);\r\n\r\n        options = options || {};\r\n        const key = options.key || 'AlIY82q0z4SlJW9J3rfNWds2dBKwqw7Rb7EJXesX56XaO4ZM1AgXcFiV8MALrHhM';\r\n        const meta = new XMLHttpRequest();\r\n        meta.open('GET', 'https://dev.virtualearth.net/REST/v1/Imagery/Metadata/Aerial?key=' + key, true);\r\n\r\n        const scope = this;\r\n        const onMetaComplete = () => {\r\n            if (meta.readyState === XMLHttpRequest.DONE) {\r\n                const response = JSON.parse(meta.response);\r\n\r\n                const resources = response.resourceSets[0].resources[0];\r\n                scope._baseUrl = resources.imageUrl;\r\n                scope._subdomains = resources.imageUrlSubdomains;\r\n                scope._zoomMax = resources.zoomMax;\r\n                scope._zoomMin = resources.zoomMin - 1;\r\n                scope._ready = true;\r\n            }\r\n        };\r\n        meta.onreadystatechange = onMetaComplete;\r\n        meta.send();\r\n    }\r\n\r\n    tileXYToQuadKey(x, y, level) {\r\n        let quadkey = '';\r\n        for (let i = level; i >= 0; --i) {\r\n            const bitmask = 1 << i;\r\n            let digit = 0;\r\n\r\n            if ((x & bitmask) !== 0) {\r\n                digit |= 1;\r\n            }\r\n\r\n            if ((y & bitmask) !== 0) {\r\n                digit |= 2;\r\n            }\r\n\r\n            quadkey += digit;\r\n        }\r\n        return quadkey;\r\n    }\r\n\r\n    protected url(x: number, y: number, z: number) {\r\n        const subdomains = this._subdomains;\r\n        const subdomainIndex = (x + y + z) % subdomains.length;\r\n\r\n        const replaceParameters = {\r\n            subdomain: subdomains[subdomainIndex],\r\n            quadkey: this.tileXYToQuadKey(x, y, z),\r\n        };\r\n\r\n        const url = Object.keys(replaceParameters).reduce((prev, key) => {\r\n            const value = replaceParameters[key];\r\n            return prev.replace(new RegExp('{' + key + '}', 'g'), encodeURIComponent(value));\r\n        }, this._baseUrl);\r\n\r\n        return url;\r\n    }\r\n\r\n    loadTile(tile: Tile) {\r\n        if (!this._ready) {\r\n            tile.quadTree.needUpdate = true;\r\n            return;\r\n        }\r\n\r\n        super.loadTile(tile);\r\n    }\r\n}\r\n","import { QuadTree } from '../Core/QuadTree';\r\nimport { TilingScheme } from '../Core/TilingScheme';\r\nimport { BingMapImageryProvider } from '../DataSource/BingMapImageryProvider';\r\nimport { Ellipsoid } from '../Math/Ellipsoid';\r\nimport { SceneMode } from './SceneMode';\r\nimport { Tile2D } from './Tile2D';\r\n\r\nfunction getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n    ellipsoid: Ellipsoid, tileImageWidth: number, numberOfTilesAtLevelZero: number) {\r\n    return ellipsoid.maximumRadius * 2 * Math.PI * 0.25 / (tileImageWidth * numberOfTilesAtLevelZero);\r\n}\r\n\r\nexport class BingMapScene extends SceneMode {\r\n    _levelZeroMaximumGeometricError: number;\r\n    constructor() {\r\n        super({\r\n            instance: Tile2D,\r\n        });\r\n\r\n        this._tilingScheme = new TilingScheme({\r\n            numberOfLevelZeroTilesX: 2,\r\n            numberOfLevelZeroTilesY: 2,\r\n        });\r\n        this.providers = [\r\n            new BingMapImageryProvider(),\r\n        ];\r\n\r\n        this._levelZeroMaximumGeometricError = getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n            this._tilingScheme.ellipsoid,\r\n            45,\r\n            this._tilingScheme.getNumberOfXTilesAtLevel(0),\r\n        );\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile2D } from '../SceneMode/Tile2D';\r\nimport { DataSource } from './DataSource';\r\nimport { DataSourceLayer } from './DataSourceLayer';\r\n\r\nexport class EPSG4326MapImageDataLayer extends DataSourceLayer {\r\n    static layerName = 'EPSG:4326';\r\n\r\n    static vertexShader = `\r\n        varying vec2 vUv;\r\n        varying vec3 vNormal;\r\n        varying vec3 vViewPosition;\r\n\r\n        void main() {\r\n\r\n            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n            vUv = uv;\r\n            vNormal = normalize( normalMatrix * normal );\r\n            vViewPosition = -mvPosition.xyz;\r\n\r\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\r\n        }\r\n    `;\r\n    static fragmentShader = `\r\n        uniform sampler2D texture;\r\n        uniform sampler2D texture2;\r\n        uniform vec3 color;\r\n        varying vec2 vUv;\r\n        varying vec3 vNormal;\r\n        varying vec3 vViewPosition;\r\n\r\n        void main() {\r\n            if ( vUv.y < 0.5) {\r\n                vec2 halfvUv = vec2( vUv.x, vUv.y * 2.0 );\r\n                gl_FragColor = texture2D( texture2, halfvUv );\r\n            } else {\r\n                vec2 halfvUv = vec2( vUv.x, vUv.y * 2.0 - 1.0 );\r\n                gl_FragColor = texture2D( texture, halfvUv );\r\n            }\r\n\r\n            // hack in a fake pointlight at camera location, plus ambient\r\n            // vec3 normal = normalize( vNormal );\r\n            // vec3 lightDir = normalize( vViewPosition );\r\n\r\n            // float dotProduct = max( dot( normal, lightDir ), 0.0 ) + 0.2;\r\n\r\n            // //gl_FragColor = vec4( mix( tColor.rgb, tColor2.rgb, tColor2.a ), 1.0 ) * dotProduct;\r\n\r\n            // vec4 mix_c = tColor2 + tc * tColor2.a;\r\n            // gl_FragColor = vec4( mix( tColor.rgb, mix_c.xyz, tColor2.a ), 1.0 ) * dotProduct;\r\n            // gl_FragColor = vec4( vUv.x, vUv.y, 0.0, 1.0 );\r\n        }\r\n    `;\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    processLoading(tile: Tile2D) {\r\n        tile.data.status[EPSG4326MapImageDataLayer.layerName] = DataSource.State.Loading;\r\n    }\r\n\r\n    processData(tile: Tile2D, data: [THREE.Texture, THREE.Texture]) {\r\n        if (tile.material) {\r\n            throw new Error('Material\\'s already set up.');\r\n        }\r\n        const uniforms = {\r\n            texture: { type: 't', value: data[0] },\r\n            texture2: { type: 't', value: data[1] },\r\n        };\r\n        tile.material = new THREE.ShaderMaterial({\r\n            uniforms,\r\n            vertexShader: EPSG4326MapImageDataLayer.vertexShader,\r\n            fragmentShader: EPSG4326MapImageDataLayer.fragmentShader,\r\n        });\r\n\r\n        tile.data.status[EPSG4326MapImageDataLayer.layerName] = DataSource.State.Loaded;\r\n    }\r\n\r\n    processError(tile: Tile2D, error: Error) {\r\n        tile.data.status[EPSG4326MapImageDataLayer.layerName] = DataSource.State.Idle;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile } from '../SceneMode/Tile';\r\nimport { EPSG4326MapImageDataLayer } from './EPSG4326MapImageDataLayer';\r\nimport { Provider, ProviderOptions } from './Provider';\r\n\r\nexport interface EPSG4326MapImageryProviderOptions extends ProviderOptions {\r\n    key?: string;\r\n}\r\n\r\nexport class EPSG4326MapImageryProvider extends Provider {\r\n    private _ready: boolean = false;\r\n\r\n    private _baseUrl: string;\r\n    private _subdomains: string[];\r\n    private _zoomMax: number;\r\n    private _zoomMin: number;\r\n\r\n    constructor(options?: EPSG4326MapImageryProviderOptions) {\r\n        super(options);\r\n\r\n        options = options || {};\r\n        const key = options.key || 'AlIY82q0z4SlJW9J3rfNWds2dBKwqw7Rb7EJXesX56XaO4ZM1AgXcFiV8MALrHhM';\r\n        const meta = new XMLHttpRequest();\r\n        meta.open('GET', 'https://dev.virtualearth.net/REST/v1/Imagery/Metadata/Aerial?key=' + key, true);\r\n\r\n        const scope = this;\r\n        const onMetaComplete = () => {\r\n            if (meta.readyState === XMLHttpRequest.DONE) {\r\n                const response = JSON.parse(meta.response);\r\n\r\n                const resources = response.resourceSets[0].resources[0];\r\n                scope._baseUrl = resources.imageUrl;\r\n                scope._subdomains = resources.imageUrlSubdomains;\r\n                scope._zoomMax = resources.zoomMax;\r\n                scope._zoomMin = resources.zoomMin - 1;\r\n                scope._ready = true;\r\n            }\r\n        };\r\n        meta.onreadystatechange = onMetaComplete;\r\n        meta.send(null);\r\n    }\r\n\r\n    tileXYToQuadKey(x, y, level) {\r\n        let quadkey = '';\r\n        for (let i = level; i >= 0; --i) {\r\n            const bitmask = 1 << i;\r\n            let digit = 0;\r\n\r\n            if ((x & bitmask) !== 0) {\r\n                digit |= 1;\r\n            }\r\n\r\n            if ((y & bitmask) !== 0) {\r\n                digit |= 2;\r\n            }\r\n\r\n            quadkey += digit;\r\n        }\r\n        return quadkey;\r\n    }\r\n\r\n    protected url(x: number, y: number, z: number) {\r\n        const subdomains = this._subdomains;\r\n        const subdomainIndex = (x + y + z) % subdomains.length;\r\n\r\n        const replaceParameters = {\r\n            subdomain: subdomains[subdomainIndex],\r\n            quadkey: this.tileXYToQuadKey(x, y, z),\r\n        };\r\n\r\n        const url = Object.keys(replaceParameters).reduce((prev, key) => {\r\n            const value = replaceParameters[key];\r\n            return prev.replace(new RegExp('{' + key + '}', 'g'), encodeURIComponent(value));\r\n        }, this._baseUrl);\r\n\r\n        return url;\r\n    }\r\n\r\n    loadTile(tile: Tile) {\r\n        if (!this._ready) {\r\n            tile.quadTree.needUpdate = true;\r\n            return;\r\n        }\r\n        if (this._loading >= this._maxLoad || tile.data.isLoading(EPSG4326MapImageDataLayer.layerName)) {\r\n            return;\r\n        }\r\n\r\n        // FIXME: Debugging\r\n        // if (tile.z >= 1) return;\r\n\r\n        let doneCount = 0;\r\n\r\n        const scope = this;\r\n        const onComplete = (resp) => {\r\n            scope._needUpdate = true;\r\n            scope._loading--;\r\n\r\n            if (tile.disposed) {\r\n                return;\r\n            }\r\n\r\n            doneCount++;\r\n            if (doneCount === 2) {\r\n                tile.data.loaded(EPSG4326MapImageDataLayer.layerName, [t0, t1]);\r\n            }\r\n        };\r\n\r\n        const onError = (err) => {\r\n            if (err) {\r\n                if (tile.disposed) {\r\n                    return;\r\n                }\r\n                scope._loading--;\r\n\r\n                console.error('Error loading texture' + tile.stringify);\r\n                tile.data.failed(EPSG4326MapImageDataLayer.layerName, err);\r\n            }\r\n        };\r\n\r\n        this._loading++;\r\n        const t0 = new THREE.TextureLoader()\r\n            .load(this.url(tile.x, tile.y * 2, tile.z), onComplete, undefined, onError);\r\n        const t1 = new THREE.TextureLoader()\r\n            .load(this.url(tile.x, tile.y * 2 + 1, tile.z), onComplete, undefined, onError);\r\n        tile.data.loading(EPSG4326MapImageDataLayer.layerName);\r\n    }\r\n}\r\n","export function highwaterDecode(indices: Uint16Array) {\n    const arr: number[] = [];\n\n    let highest = 0;\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < indices.length; ++i) {\n        const code = indices[i];\n        arr.push(highest - code);\n        if (code === 0) {\n            ++highest;\n        }\n    }\n    return arr;\n}\n\nexport function zigZagDecode(value) {\n    return (value >> 1) ^ (-(value & 1));\n}\n\nexport function getUint32Array(data, startPos, count) {\n    return new Uint32Array(data.slice(startPos, startPos + 4 * count));\n}\nexport function getUint32(data, startPos) {\n    return getUint32Array(data, startPos, 1)[0];\n}\nexport function getUint16Array(data, startPos, count) {\n    return new Uint16Array(data.slice(startPos, startPos + 2 * count));\n}\nexport function getUint16(data, startPos) {\n    return getUint16Array(data, startPos, 1)[0];\n}\nexport function getFloat64Array(data, startPos, count) {\n    return new Float64Array(data.slice(startPos, startPos + 8 * count));\n}\nexport function getFloat64(data, startPos) {\n    return getFloat64Array(data, startPos, 1)[0];\n}\nexport function getFloat32Array(data, startPos, count) {\n    return new Float32Array(data.slice(startPos, startPos + 4 * count));\n}\nexport function getFloat32(data, startPos) {\n    return getFloat32Array(data, startPos, 1)[0];\n}\n\nexport const UINT16_BYTE_SIZE = 2;\nexport const UINT32_BYTE_SIZE = 4;\nexport const FLOAT64_BYTE_SIZE = 8;\nexport const FLOAT32_BYTE_SIZE = 4;\n","import * as THREE from 'three';\r\nimport { TileReplacementQueue } from '../Core/TileReplacementQueue';\r\nimport { STKTerrainTile } from '../SceneMode/STKTerrainTile';\r\nimport { MapUtility } from '../Utility/MapUtility';\r\nimport { DataSource } from './DataSource';\r\nimport { DataSourceLayer } from './DataSourceLayer';\r\nimport { QuantizedMesh } from './STKTerrainProvider';\r\n\r\nconst maxShort = 32767;\r\n\r\nexport class STKTerrainDataLayer extends DataSourceLayer {\r\n    static layerName = 'terrain-stk';\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    getVertices(header, uArray, vArray, heightArray, indexArray) {\r\n        return uArray.reduce((prev, _, index) => {\r\n            prev.push(new THREE.Vector3(\r\n                uArray[index] / maxShort - 0.5,\r\n                MapUtility.lerp(header.minimumHeight, header.maximumHeight, heightArray[index] / maxShort)\r\n                    + header.minimumHeight,\r\n                0.5 - vArray[index] / maxShort,\r\n            ));\r\n            return prev;\r\n        }, []);\r\n    }\r\n\r\n    getFaces(header, uArray, vArray, heightArray, indexArray) {\r\n        const faces = [];\r\n        for (let i = 0; i < indexArray.length; i += 3) {\r\n            faces.push(new THREE.Face3(indexArray[i + 0], indexArray[i + 1], indexArray[i + 2]));\r\n        }\r\n        return faces;\r\n    }\r\n\r\n    getFaceVertexUvs(header, uArray, vArray, heightArray, indexArray) {\r\n        const verticesUv = uArray.reduce((prev, _, index) => {\r\n            prev.push(new THREE.Vector2(\r\n                uArray[index] / 32767,\r\n                vArray[index] / 32767,\r\n            ));\r\n            return prev;\r\n        }, []);\r\n\r\n        const faceVertexUvs = [];\r\n        for (let i = 0; i < indexArray.length; i += 3) {\r\n            faceVertexUvs.push([\r\n                verticesUv[indexArray[i + 0]],\r\n                verticesUv[indexArray[i + 1]],\r\n                verticesUv[indexArray[i + 2]],\r\n            ]);\r\n        }\r\n        return faceVertexUvs;\r\n    }\r\n\r\n    processLoading(tile: STKTerrainTile) {\r\n        tile.data.status[STKTerrainDataLayer.layerName] = DataSource.State.Loading;\r\n    }\r\n\r\n    processData(tile: STKTerrainTile, data: QuantizedMesh) {\r\n        const header = data.header;\r\n        const uArray = data.uArray;\r\n        const vArray = data.vArray;\r\n        const heightArray = data.heightArray;\r\n        const indexArray = data.indexArray;\r\n\r\n        const vertices = this.getVertices(header, uArray, vArray, heightArray, indexArray);\r\n        const faces = this.getFaces(header, uArray, vArray, heightArray, indexArray);\r\n\r\n        tile.geometry = new THREE.Geometry();\r\n        tile.geometry.vertices = vertices;\r\n        tile.geometry.faces = faces;\r\n\r\n        tile.geometry.computeFaceNormals();\r\n        tile.geometry.computeVertexNormals();\r\n        tile.geometry.faceVertexUvs[0] = this.getFaceVertexUvs(header, uArray, vArray, heightArray, indexArray);\r\n        tile.geometry.uvsNeedUpdate = true;\r\n\r\n        // tile.bbox.yMin = header.minimumHeight;\r\n        // tile.bbox.yMax = header.maximumHeight;\r\n        // console.log(tile.bbox.center, header.centerX, header.centerY, header.centerZ)\r\n\r\n        tile.data.status[STKTerrainDataLayer.layerName] = DataSource.State.Loaded;\r\n    }\r\n\r\n    processError(tile: STKTerrainTile, error: Error) {\r\n        tile.data.status[STKTerrainDataLayer.layerName] = DataSource.State.Idle;\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { Tile } from '../SceneMode/Tile';\r\nimport * as c from '../Utility/TypeConversion';\r\nimport { Provider, ProviderOptions } from './Provider';\r\nimport { STKTerrainDataLayer } from './STKTerrainDataLayer';\r\n\r\nexport interface STKTerrainProviderOptions extends ProviderOptions {}\r\n\r\nexport namespace QuantizedMesh {\r\n    export interface Header {\r\n        bytes: number;\r\n        centerX: number;\r\n        centerY: number;\r\n        centerZ: number;\r\n        minimumHeight: number;\r\n        maximumHeight: number;\r\n        boundingSphereCenterX: number;\r\n        boundingSphereCenterY: number;\r\n        boundingSphereCenterZ: number;\r\n        boundingSphereRadius: number;\r\n        horizonOcclusionPointX: number;\r\n        horizonOcclusionPointY: number;\r\n        horizonOcclusionPointZ: number;\r\n    }\r\n}\r\n\r\nexport interface QuantizedMesh {\r\n    header: QuantizedMesh.Header;\r\n    uArray: Uint16Array;\r\n    vArray: Uint16Array;\r\n    heightArray: Uint16Array;\r\n    indexArray: number[];\r\n}\r\n\r\nexport class STKTerrainProvider extends Provider {\r\n    private _ready: boolean = false;\r\n    private _baseUrl: string;\r\n    private _zoomMax: number;\r\n    private _zoomMin: number;\r\n    private _version: string;\r\n    private _projection: string;\r\n\r\n    constructor(options?: STKTerrainProviderOptions) {\r\n        super(options);\r\n\r\n        const meta = new XMLHttpRequest();\r\n        // meta.open('GET', 'http://assets.agi.com/stk-terrain/v1/tilesets/world/tiles/layer.json', true);\r\n        meta.open('GET', 'layer.json', true);\r\n\r\n        const scope = this;\r\n        const onMetaComplete = () => {\r\n            const response = JSON.parse(meta.response);\r\n            scope._baseUrl = `http://assets.agi.com/stk-terrain/v1/tilesets/world/tiles/${response.tiles}`;\r\n            scope._zoomMax = response.maxzoom;\r\n            scope._zoomMin = response.minzoom;\r\n            scope._version = response.version;\r\n            scope._projection = response.projection;\r\n\r\n            scope._ready = true;\r\n        };\r\n        meta.setRequestHeader('Accept', 'application/json,*/*;q=0.01');\r\n        meta.addEventListener('load', onMetaComplete);\r\n        meta.send(null);\r\n    }\r\n\r\n    url(x: number, y: number, z: number) {\r\n        const replaceParameters = {\r\n            x,\r\n            y: (1 << z) - 1 - y,\r\n            z,\r\n            version: this._version,\r\n        };\r\n\r\n        const url = Object.keys(replaceParameters).reduce((prev, key) => {\r\n            const value = replaceParameters[key];\r\n            return prev.replace(new RegExp('{' + key + '}', 'g'), encodeURIComponent(value));\r\n        }, this._baseUrl);\r\n\r\n        return url;\r\n    }\r\n\r\n    getHeader(data, byteCount): QuantizedMesh.Header {\r\n        return {\r\n            bytes: data.byteLength,\r\n            centerX: c.getFloat64(data, byteCount),\r\n            centerY: c.getFloat64(data, byteCount + 8),\r\n            centerZ: c.getFloat64(data, byteCount + 16),\r\n            minimumHeight: c.getFloat32(data, byteCount + 24),\r\n            maximumHeight: c.getFloat32(data, byteCount + 28),\r\n            boundingSphereCenterX: c.getFloat64(data, byteCount + 32),\r\n            boundingSphereCenterY: c.getFloat64(data, byteCount + 40),\r\n            boundingSphereCenterZ: c.getFloat64(data, byteCount + 48),\r\n            boundingSphereRadius: c.getFloat64(data, byteCount + 56),\r\n            horizonOcclusionPointX: c.getFloat64(data, byteCount + 64),\r\n            horizonOcclusionPointY: c.getFloat64(data, byteCount + 72),\r\n            horizonOcclusionPointZ: c.getFloat64(data, byteCount + 80),\r\n        };\r\n    }\r\n\r\n    parseTile(data): QuantizedMesh {\r\n        let byteCount = 0;\r\n\r\n        const header = this.getHeader(data, byteCount);\r\n        byteCount += 88;\r\n\r\n        const vertexCount = c.getUint32(data, byteCount);\r\n        byteCount += c.UINT32_BYTE_SIZE;\r\n\r\n        const uArray = c.getUint16Array(data, byteCount, vertexCount);\r\n        byteCount += vertexCount * c.UINT16_BYTE_SIZE;\r\n\r\n        const vArray = c.getUint16Array(data, byteCount, vertexCount);\r\n        byteCount += vertexCount * c.UINT16_BYTE_SIZE;\r\n\r\n        const heightArray = c.getUint16Array(data, byteCount, vertexCount);\r\n        byteCount += vertexCount * c.UINT16_BYTE_SIZE;\r\n\r\n        let i;\r\n        let u = 0;\r\n        let v = 0;\r\n        let height = 0;\r\n\r\n        for (i = 0; i < uArray.length; ++i) {\r\n            u += c.zigZagDecode(uArray[i]);\r\n            v += c.zigZagDecode(vArray[i]);\r\n            height += c.zigZagDecode(heightArray[i]);\r\n\r\n            uArray[i] = u;\r\n            vArray[i] = v;\r\n            heightArray[i] = height;\r\n        }\r\n\r\n        if (byteCount % 2 !== 0) {\r\n            byteCount += (2 - (byteCount % 2));\r\n        }\r\n\r\n        const triangleCount = c.getUint32(data, byteCount);\r\n        byteCount += c.UINT32_BYTE_SIZE;\r\n\r\n        const indices = c.getUint16Array(data, byteCount, triangleCount * 3);\r\n        byteCount += triangleCount * 3 * 2;\r\n\r\n        const indexArray = c.highwaterDecode(indices);\r\n        return { header, uArray, vArray, heightArray, indexArray };\r\n    }\r\n\r\n    loadTile(tile: Tile) {\r\n        if (!this._ready) {\r\n            tile.quadTree.needUpdate = true;\r\n            return;\r\n        }\r\n\r\n        if (this._loading >= this._maxLoad || tile.data.isLoading(STKTerrainDataLayer.layerName)) {\r\n            return;\r\n        }\r\n\r\n        // FIXME: Debugging\r\n        // if (tile.z >= 1) return;\r\n\r\n        this._loading++;\r\n\r\n        const onComplete = (resp) => {\r\n            if (xhr.readyState === XMLHttpRequest.DONE) {\r\n                this._needUpdate = true;\r\n                this._loading--;\r\n\r\n                if (tile.disposed) {\r\n                    return;\r\n                }\r\n                tile.data.loaded(STKTerrainDataLayer.layerName, this.parseTile(xhr.response));\r\n            }\r\n        };\r\n\r\n        const onError = (err) => {\r\n            if (err) {\r\n                if (tile.disposed) {\r\n                    return;\r\n                }\r\n                this._loading--;\r\n\r\n                console.error('Error loading stk-terrain' + tile.stringify);\r\n                tile.data.failed(STKTerrainDataLayer.layerName, err);\r\n            }\r\n        };\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open('GET', this.url(tile.x, tile.y, tile.z), true);\r\n        xhr.setRequestHeader('Accept', ' application/vnd.quantized-mesh,application/octet-stream;q=1.0');\r\n        xhr.responseType = 'arraybuffer';\r\n        xhr.onreadystatechange = onComplete;\r\n        xhr.send();\r\n\r\n        tile.data.loading(STKTerrainDataLayer.layerName);\r\n    }\r\n}\r\n","import * as THREE from 'three';\r\nimport { DataSource } from '../DataSource/DataSource';\r\nimport { EPSG4326MapImageDataLayer } from '../DataSource/EPSG4326MapImageDataLayer';\r\nimport { STKTerrainDataLayer } from '../DataSource/STKTerrainDataLayer';\r\nimport { TestDataLayer } from '../DataSource/TestDataLayer';\r\nimport { Tile, TileOptions } from '../SceneMode/Tile';\r\n\r\nexport interface STKTerrainTileOptions extends TileOptions {}\r\n\r\nconst image = new Image();\r\nexport class STKTerrainTile extends Tile {\r\n    static dataLayers = DataSource.toLayers([\r\n        EPSG4326MapImageDataLayer,\r\n        STKTerrainDataLayer,\r\n    ]);\r\n\r\n    public data: DataSource;\r\n    private _material: THREE.Material;\r\n    private _geometry: THREE.Geometry;\r\n\r\n    constructor(options: STKTerrainTileOptions) {\r\n        super(options);\r\n        this.data = new DataSource({\r\n            layers: STKTerrainTile.dataLayers,\r\n            tile: this,\r\n        });\r\n    }\r\n\r\n    static createMesh() {\r\n        const material = new THREE.MeshBasicMaterial({\r\n            wireframe: true,\r\n            opacity: 0,\r\n        });\r\n\r\n        const geometry = new THREE.PlaneBufferGeometry(1, 1, 2, 2);\r\n\r\n        return new THREE.Mesh(geometry, material);\r\n    }\r\n\r\n    applyDataToMesh(mesh: THREE.Mesh) {\r\n        const tileSize = Tile.size(this.z);\r\n\r\n        mesh.material = this._material;\r\n\r\n        mesh.scale.set(\r\n            this.bbox.width,\r\n            1,\r\n            this.bbox.height,\r\n        );\r\n\r\n        mesh.geometry = this._geometry;\r\n\r\n        mesh.position.y = this.bbox.yMin;\r\n    }\r\n\r\n    dispose() {\r\n        super.dispose();\r\n    }\r\n\r\n    get geometry() { return this._geometry; }\r\n    set geometry(g) { this._geometry = g; }\r\n    get material() { return this._material; }\r\n    set material(m) { this._material = m; }\r\n}\r\n","import { QuadTree } from '../Core/QuadTree';\r\nimport { TilingScheme } from '../Core/TilingScheme';\r\nimport { EPSG4326MapImageryProvider } from '../DataSource/EPSG4326MapImageryProvider';\r\nimport { STKTerrainProvider } from '../DataSource/STKTerrainProvider';\r\nimport { AABB } from '../Math/AABB';\r\nimport { Cartesian } from '../Math/Cartesian';\r\nimport { Ellipsoid } from '../Math/Ellipsoid';\r\nimport { sphericalMercator } from '../Utility/SphericalMercator';\r\nimport { SceneMode } from './SceneMode';\r\nimport { STKTerrainTile } from './STKTerrainTile';\r\nimport { Tile } from './Tile';\r\n\r\nfunction getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n    ellipsoid: Ellipsoid, tileImageWidth: number, numberOfTilesAtLevelZero: number) {\r\n    return ellipsoid.maximumRadius * 2 * Math.PI * 0.25 / (tileImageWidth * numberOfTilesAtLevelZero);\r\n}\r\n\r\nconst topLeftCorner = new Cartesian();\r\nconst bottomRightCorner = new Cartesian();\r\n\r\nexport class STKTerrainScene extends SceneMode {\r\n    protected _levelZeroMaximumGeometricError: number;\r\n    constructor() {\r\n        super({\r\n            instance: STKTerrainTile,\r\n        });\r\n\r\n        this._tilingScheme = new TilingScheme({\r\n            numberOfLevelZeroTilesX: 2,\r\n            numberOfLevelZeroTilesY: 1,\r\n        });\r\n        this.providers = [\r\n            new EPSG4326MapImageryProvider(),\r\n            new STKTerrainProvider(),\r\n        ];\r\n\r\n        this._levelZeroMaximumGeometricError = getEstimatedLevelZeroGeometricErrorForAHeightmap(\r\n            this._tilingScheme.ellipsoid,\r\n            45,\r\n            this._tilingScheme.getNumberOfYTilesAtLevel(0),\r\n        );\r\n    }\r\n\r\n    // getAABB(tile: Tile) {\r\n    //     // FIXME: FC\r\n    //     const width = 360.0 / this._tilingScheme.getNumberOfXTilesAtLevel(tile.z);\r\n    //     const height = 180.0 / this._tilingScheme.getNumberOfYTilesAtLevel(tile.z);\r\n    //     this._topLeftCartographicCorner.longitude = tile.x * width - 180.0;\r\n    //     this._topLeftCartographicCorner.altitude = 0;\r\n    //     this._topLeftCartographicCorner.latitude = tile.y * height - 90.0;\r\n    //     sphericalMercator.CartographicToEPSG4326(this._topLeftCartographicCorner, topLeftCorner);\r\n\r\n    //     this._bottomRightCartographicCorner.longitude = (tile.x + 1) * width - 180.0;\r\n    //     this._bottomRightCartographicCorner.altitude = 0;\r\n    //     this._bottomRightCartographicCorner.latitude = (tile.y + 1) * height - 90.0;\r\n    //     sphericalMercator.CartographicToEPSG4326(this._bottomRightCartographicCorner, bottomRightCorner);\r\n\r\n    //     return new AABB({ topLeftCorner, bottomRightCorner });\r\n    // }\r\n}\r\n"],"names":["THREE.Matrix4","THREE.Vector3","THREE.Vector2","tslib_1.__extends","THREE.CylinderGeometry","THREE.Mesh","THREE.MeshBasicMaterial","THREE.Geometry","THREE.LineSegments","THREE.LineBasicMaterial","THREE.Group","THREE.Raycaster","panStart","picker","panEnd","panDelta","px","THREE.CubeTexture","THREE.RGBFormat","THREE.DoubleSide","THREE.MeshFaceMaterial","THREE.CubeGeometry","THREE.Face3","THREE.PerspectiveCamera","THREE.Quaternion","screenPosition","THREE.MOUSE","THREE.EventDispatcher","THREE.Frustum","THREE.Scene","THREE.TextureLoader","t","THREE.PlaneGeometry","image","getEstimatedLevelZeroGeometricErrorForAHeightmap","THREE.ShaderMaterial","c.getFloat64","c.getFloat32","c.getUint32","c.UINT32_BYTE_SIZE","c.getUint16Array","c.UINT16_BYTE_SIZE","c.zigZagDecode","c.highwaterDecode","THREE.PlaneBufferGeometry","topLeftCorner","bottomRightCorner"],"mappings":"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"}